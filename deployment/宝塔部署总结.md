# ğŸ¯ TRONèƒ½é‡ç§Ÿèµç³»ç»Ÿ - å®å¡”é¢æ¿éƒ¨ç½²æ€»ç»“

## ğŸ“‹ éƒ¨ç½²æ–‡ä»¶æ¸…å•

æˆ‘å·²ç»ä¸ºä½ çš„é¡¹ç›®åˆ›å»ºäº†å®Œæ•´çš„å®å¡”é¢æ¿éƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

### ğŸ“ æ ¸å¿ƒæ–‡æ¡£
- `deployment/å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—.md` - **è¯¦ç»†éƒ¨ç½²æ–‡æ¡£**ï¼ˆ60é¡µè¯¦ç»†æŒ‡å—ï¼‰
- `deployment/README.md` - **å¿«é€Ÿéƒ¨ç½²æŒ‡å—**ï¼ˆé€‚åˆæœ‰ç»éªŒçš„å¼€å‘è€…ï¼‰
- `deployment/å®å¡”éƒ¨ç½²æ€»ç»“.md` - **æœ¬æ–‡æ¡£**ï¼ˆæ€»ç»“æ¦‚è§ˆï¼‰

### âš™ï¸ é…ç½®æ–‡ä»¶
- `deployment/configs/ecosystem.config.js` - **PM2è¿›ç¨‹ç®¡ç†é…ç½®**
- `deployment/configs/.env.production.template` - **ç”Ÿäº§ç¯å¢ƒå˜é‡æ¨¡æ¿**
- `deployment/configs/nginx-same-server.conf` - **Nginxé…ç½®ç¤ºä¾‹**

### ğŸš€ è‡ªåŠ¨åŒ–è„šæœ¬
- `deployment/scripts/install.sh` - **ä¸€é”®ç¯å¢ƒå®‰è£…è„šæœ¬**
- `deployment/scripts/deploy.sh` - **è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬**  
- `deployment/scripts/health-check.sh` - **å¥åº·æ£€æŸ¥è„šæœ¬**

---

## ğŸ–¥ï¸ æœåŠ¡å™¨è¦æ±‚

### æœ€ä½é…ç½®è¦æ±‚
```
CPU:    2æ ¸
å†…å­˜:   4GB RAM
å­˜å‚¨:   40GB SSD
å¸¦å®½:   5Mbps
æ“ä½œç³»ç»Ÿ: Ubuntu 20.04+ / CentOS 7+ / Debian 10+
```

### æ¨èé…ç½®
```
CPU:    4æ ¸ä»¥ä¸Š
å†…å­˜:   8GB RAMä»¥ä¸Š
å­˜å‚¨:   100GB SSDä»¥ä¸Š
å¸¦å®½:   10Mbpsä»¥ä¸Š
```

### è½¯ä»¶ä¾èµ–
- **å®å¡”é¢æ¿** 7.0+
- **Nginx** 1.20+
- **Node.js** 18.0+
- **PostgreSQL** 13+
- **Redis** 6.0+
- **PM2** (è¿›ç¨‹ç®¡ç†)

---

## ğŸš€ ä¸‰ç§éƒ¨ç½²æ–¹å¼

### æ–¹å¼1ï¼šä¸€é”®è‡ªåŠ¨éƒ¨ç½² â­â­â­â­â­
```bash
# é€‚ç”¨äºå…¨æ–°æœåŠ¡å™¨
sudo ./deployment/scripts/install.sh  # å®‰è£…ç¯å¢ƒ
./deployment/scripts/deploy.sh        # éƒ¨ç½²é¡¹ç›®
```
**ä¼˜ç‚¹ï¼š** å…¨è‡ªåŠ¨åŒ–ï¼Œé€‚åˆæ–°æ‰‹  
**æ—¶é—´ï¼š** 20-30åˆ†é’Ÿ

### æ–¹å¼2ï¼šè„šæœ¬è¾…åŠ©éƒ¨ç½² â­â­â­â­â˜†
```bash
# æ‰‹åŠ¨å®‰è£…å®å¡”ç¯å¢ƒå
./deployment/scripts/deploy.sh        # è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®
```
**ä¼˜ç‚¹ï¼š** çµæ´»æ€§é«˜ï¼Œé€‚åˆæœ‰å®å¡”ç»éªŒè€…  
**æ—¶é—´ï¼š** 30-45åˆ†é’Ÿ

### æ–¹å¼3ï¼šæ‰‹åŠ¨é€æ­¥éƒ¨ç½² â­â­â­â˜†â˜†
æŒ‰ç…§ `å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—.md` é€æ­¥æ“ä½œ
**ä¼˜ç‚¹ï¼š** å®Œå…¨å¯æ§ï¼Œé€‚åˆæ·±åº¦å®šåˆ¶  
**æ—¶é—´ï¼š** 60-90åˆ†é’Ÿ

---

## ğŸ” å®‰å…¨é…ç½®è¦ç‚¹

### å¿…é¡»ä¿®æ”¹çš„é…ç½®
1. **æ•°æ®åº“å¯†ç ** - é»˜è®¤postgres/postgreséœ€è¦ä¿®æ”¹
2. **JWTå¯†é’¥** - ç”Ÿæˆ32ä½ä»¥ä¸Šéšæœºå­—ç¬¦ä¸²
3. **ç®¡ç†å‘˜å¯†ç ** - é»˜è®¤admin123456éœ€è¦ä¿®æ”¹
4. **åŸŸåé…ç½®** - ä¿®æ”¹ä¸ºå®é™…åŸŸå
5. **CORSè®¾ç½®** - é™åˆ¶å…è®¸çš„æ¥æºåŸŸå

### æ¨èçš„å®‰å…¨æªæ–½
```bash
# 1. å¯ç”¨é˜²ç«å¢™
ufw enable
ufw allow 80,443,22/tcp

# 2. ä¿®æ”¹SSHç«¯å£
# ç¼–è¾‘ /etc/ssh/sshd_config
Port 2022

# 3. å®‰è£…fail2ban
apt install fail2ban

# 4. è®¾ç½®SSLè¯ä¹¦
# é€šè¿‡å®å¡”é¢æ¿ç”³è¯·Let's Encryptè¯ä¹¦

# 5. å®šæœŸå¤‡ä»½
# è®¾ç½®è‡ªåŠ¨æ•°æ®åº“å¤‡ä»½
```

### ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•
- [ ] ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
- [ ] é…ç½®SSLè¯ä¹¦
- [ ] è®¾ç½®é˜²ç«å¢™è§„åˆ™
- [ ] å¯ç”¨è‡ªåŠ¨å¤‡ä»½
- [ ] é…ç½®ç›‘æ§å‘Šè­¦
- [ ] æµ‹è¯•æ•…éšœæ¢å¤
- [ ] å‹åŠ›æµ‹è¯•
- [ ] å®‰å…¨æ‰«æ

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### å¥åº·æ£€æŸ¥é…ç½®
```bash
# æ·»åŠ åˆ°crontab
*/5 * * * * /www/wwwroot/tron-energy-rental/deployment/scripts/health-check.sh -q -r

# æ£€æŸ¥é¡¹ç›®ï¼š
# âœ“ PM2è¿›ç¨‹çŠ¶æ€
# âœ“ APIå¥åº·æ£€æŸ¥  
# âœ“ æ•°æ®åº“è¿æ¥
# âœ“ Redisè¿æ¥
# âœ“ ç£ç›˜ç©ºé—´
# âœ“ å†…å­˜ä½¿ç”¨
# âœ“ CPUè´Ÿè½½
```

### æ—¥å¿—ç®¡ç†
```bash
# æ—¥å¿—æ–‡ä»¶ä½ç½®
/www/wwwroot/tron-energy-rental/logs/
â”œâ”€â”€ api-error.log          # APIé”™è¯¯æ—¥å¿—
â”œâ”€â”€ api-out.log            # APIè¾“å‡ºæ—¥å¿—
â”œâ”€â”€ telegram-error.log     # Telegramæœºå™¨äººé”™è¯¯æ—¥å¿—
â””â”€â”€ health-check.log       # å¥åº·æ£€æŸ¥æ—¥å¿—

# è‡ªåŠ¨æ—¥å¿—è½®è½¬
# æ¯æ—¥ä¿ç•™ï¼Œ7å¤©åè‡ªåŠ¨åˆ é™¤
```

### ç›‘æ§é¢æ¿é›†æˆ
- **å®å¡”é¢æ¿ç›‘æ§** - ç³»ç»Ÿèµ„æºç›‘æ§
- **PM2ç›‘æ§** - è¿›ç¨‹çŠ¶æ€ç›‘æ§
- **è‡ªå®šä¹‰ç›‘æ§** - ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

---

## ğŸ”§ å¸¸ç”¨è¿ç»´å‘½ä»¤

### æœåŠ¡ç®¡ç†
```bash
# å¯åŠ¨æœåŠ¡
pm2 start ecosystem.config.js --env production

# é‡å¯æœåŠ¡
pm2 restart ecosystem.config.js

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs

# æŸ¥çœ‹ç›‘æ§
pm2 monit
```

### æ•°æ®åº“æ“ä½œ
```bash
# è¿æ¥æ•°æ®åº“
psql postgresql://tron_user:password@localhost:5432/tron_energy_rental

# å¤‡ä»½æ•°æ®åº“
pg_dump -h localhost -U tron_user -d tron_energy_rental > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
psql -h localhost -U tron_user -d tron_energy_rental < backup.sql

# è¿è¡Œè¿ç§»
pnpm run migrate
```

### é¡¹ç›®æ›´æ–°
```bash
# æ›´æ–°æµç¨‹
git pull origin main          # æ‹‰å–ä»£ç 
pnpm install                  # å®‰è£…ä¾èµ–
pnpm run build               # æ„å»ºå‰ç«¯
pnpm run migrate             # è¿è¡Œè¿ç§»
pm2 restart ecosystem.config.js  # é‡å¯æœåŠ¡
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æœåŠ¡å™¨å±‚é¢
- **CPU**: ç›‘æ§è´Ÿè½½ï¼Œå¿…è¦æ—¶å‡çº§
- **å†…å­˜**: å»ºè®®è‡³å°‘8GBï¼Œé¢„ç•™30%ç©ºé—´
- **å­˜å‚¨**: ä½¿ç”¨SSDï¼Œå®šæœŸæ¸…ç†æ—¥å¿—
- **ç½‘ç»œ**: CDNåŠ é€Ÿé™æ€èµ„æº

### åº”ç”¨å±‚é¢
- **æ•°æ®åº“è¿æ¥æ± **: é»˜è®¤50ä¸ªè¿æ¥
- **Redisç¼“å­˜**: å¯ç”¨æ•°æ®ç¼“å­˜
- **PM2é›†ç¾¤**: æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´
- **Nginxç¼“å­˜**: é™æ€èµ„æºç¼“å­˜1å¹´

### ç›‘æ§æŒ‡æ ‡
```bash
# å…³é”®æŒ‡æ ‡
- APIå“åº”æ—¶é—´ < 500ms
- æ•°æ®åº“è¿æ¥æ•° < 40
- å†…å­˜ä½¿ç”¨ç‡ < 80%
- CPUä½¿ç”¨ç‡ < 70%
- ç£ç›˜ä½¿ç”¨ç‡ < 85%
```

---

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥æ—¥å¿—
pm2 logs
tail -f /www/wwwroot/tron-energy-rental/logs/api-error.log

# å¸¸è§åŸå› 
- ç«¯å£è¢«å ç”¨: netstat -tlnp | grep :3001
- æƒé™é—®é¢˜: chown -R www-data:www-data /www/wwwroot/tron-energy-rental
- ä¾èµ–ç¼ºå¤±: pnpm install
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
systemctl status postgresql

# æµ‹è¯•è¿æ¥
psql -h localhost -U tron_user -d tron_energy_rental -c "SELECT 1;"

# å¸¸è§åŸå› 
- å¯†ç é”™è¯¯: æ£€æŸ¥.env.productioné…ç½®
- æœåŠ¡æœªå¯åŠ¨: systemctl start postgresql
- é˜²ç«å¢™é˜»æ­¢: ufw allow 5432
```

#### 3. å‰ç«¯é¡µé¢æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥NginxçŠ¶æ€
systemctl status nginx

# æµ‹è¯•é…ç½®
nginx -t

# å¸¸è§åŸå› 
- é…ç½®è¯­æ³•é”™è¯¯: nginx -t
- æ–‡ä»¶æƒé™é—®é¢˜: chmod -R 755 /www/wwwroot/tron-energy-rental/dist
- SSLè¯ä¹¦è¿‡æœŸ: é‡æ–°ç”³è¯·è¯ä¹¦
```

#### 4. APIæ¥å£é”™è¯¯
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3001/api/health

# æ£€æŸ¥è¿›ç¨‹
pm2 status

# å¸¸è§åŸå› 
- ç¯å¢ƒå˜é‡é”™è¯¯: æ£€æŸ¥.env.production
- æ•°æ®åº“è¿ç§»æœªæ‰§è¡Œ: pnpm run migrate
- JWTå¯†é’¥é…ç½®é”™è¯¯: æ£€æŸ¥JWT_SECRET
```

---

## ğŸ¯ éƒ¨ç½²æˆåŠŸéªŒè¯

### æ£€æŸ¥æ¸…å•
- [ ] **PM2è¿›ç¨‹æ­£å¸¸è¿è¡Œ**: `pm2 status` æ˜¾ç¤º online
- [ ] **APIå¥åº·æ£€æŸ¥é€šè¿‡**: `curl http://localhost:3001/api/health` è¿”å›200
- [ ] **å‰ç«¯é¡µé¢å¯è®¿é—®**: æµè§ˆå™¨èƒ½æ‰“å¼€é¦–é¡µ
- [ ] **æ•°æ®åº“è¿æ¥æ­£å¸¸**: èƒ½å¤Ÿç™»å½•ç®¡ç†åå°
- [ ] **Redisç¼“å­˜å·¥ä½œ**: ç¼“å­˜åŠŸèƒ½æ­£å¸¸
- [ ] **æ—¥å¿—è®°å½•æ­£å¸¸**: æ—¥å¿—æ–‡ä»¶æœ‰å†…å®¹ç”Ÿæˆ
- [ ] **SSLè¯ä¹¦æœ‰æ•ˆ**: HTTPSè®¿é—®æ­£å¸¸
- [ ] **ç›‘æ§å‘Šè­¦é…ç½®**: å¥åº·æ£€æŸ¥è„šæœ¬æ­£å¸¸è¿è¡Œ

### æ€§èƒ½æµ‹è¯•
```bash
# ç®€å•å‹åŠ›æµ‹è¯•
ab -n 100 -c 10 https://yourdomain.com/api/health

# é¢„æœŸç»“æœ
# Requests per second: > 50
# Time per request: < 200ms
# Failed requests: 0
```

---

## ğŸ“ åç»­æ”¯æŒ

### æ–‡æ¡£ä½ç½®
- **è¯¦ç»†æŒ‡å—**: `deployment/å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—.md`
- **å¿«é€ŸæŒ‡å—**: `deployment/README.md`
- **é…ç½®ç¤ºä¾‹**: `deployment/configs/`
- **è‡ªåŠ¨è„šæœ¬**: `deployment/scripts/`

### ç»´æŠ¤å»ºè®®
1. **å®šæœŸæ›´æ–°ä¾èµ–åŒ…**ï¼ˆæœˆåº¦ï¼‰
2. **æ£€æŸ¥å®‰å…¨è¡¥ä¸**ï¼ˆå‘¨åº¦ï¼‰
3. **å¤‡ä»½æ•°æ®åº“**ï¼ˆæ¯æ—¥ï¼‰
4. **ç›‘æ§ç³»ç»Ÿèµ„æº**ï¼ˆå®æ—¶ï¼‰
5. **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**ï¼ˆæ¯æ—¥ï¼‰

### æ‰©å±•åŠŸèƒ½
- **è´Ÿè½½å‡è¡¡**: ä½¿ç”¨Nginx upstreamé…ç½®
- **æ•°æ®åº“ä¸»ä»**: PostgreSQLæµå¤åˆ¶
- **å®¹å™¨åŒ–éƒ¨ç½²**: Docker + Docker Compose
- **è‡ªåŠ¨åŒ–CI/CD**: GitHub Actionséƒ¨ç½²

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬éƒ¨ç½²æ–¹æ¡ˆï¼Œä½ å¯ä»¥åœ¨å®å¡”é¢æ¿ä¸Šå¿«é€Ÿã€å®‰å…¨åœ°éƒ¨ç½²TRONèƒ½é‡ç§Ÿèµç³»ç»Ÿã€‚

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
âœ… **å®Œå…¨è‡ªåŠ¨åŒ–** - ä¸€é”®è„šæœ¬éƒ¨ç½²  
âœ… **ç”Ÿäº§çº§å®‰å…¨** - å®Œæ•´çš„å®‰å…¨é…ç½®  
âœ… **ç›‘æ§å‘Šè­¦** - ä¸»åŠ¨æ•…éšœå‘ç°  
âœ… **æ˜“äºç»´æŠ¤** - æ ‡å‡†åŒ–è¿ç»´æµç¨‹  
âœ… **é«˜å¯ç”¨æ€§** - é›†ç¾¤æ¨¡å¼éƒ¨ç½²  

**é€‚ç”¨åœºæ™¯ï¼š**
- ä¸­å°å‹ä¼ä¸šç”Ÿäº§ç¯å¢ƒ
- ä¸ªäººé¡¹ç›®å¿«é€Ÿä¸Šçº¿
- å¼€å‘æµ‹è¯•ç¯å¢ƒæ­å»º
- ç³»ç»ŸåŸå‹éªŒè¯

ç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€

---

*å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒè¯¦ç»†éƒ¨ç½²æŒ‡å—æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚*
