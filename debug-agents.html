<!DOCTYPE html>
<html>
<head>
    <title>Debug Agents API</title>
</head>
<body>
    <h1>Debug Agents API</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }
        
        // 检查localStorage
        log('检查localStorage:');
        log('admin_token: ' + localStorage.getItem('admin_token'));
        log('admin_user: ' + localStorage.getItem('admin_user'));
        
        // 测试API调用
        async function testAPI() {
            try {
                log('\n测试代理商API调用...');
                
                const token = localStorage.getItem('admin_token');
                if (!token) {
                    log('❌ 没有找到admin_token，需要先登录');
                    return;
                }
                
                const response = await fetch('http://localhost:3001/api/agents', {
                    headers: {
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    }
                });
                
                log('响应状态: ' + response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    log('✅ API调用成功');
                    log('代理商数量: ' + (data.data?.agents?.length || 0));
                    log('响应数据: ' + JSON.stringify(data, null, 2));
                } else {
                    const errorData = await response.text();
                    log('❌ API调用失败: ' + errorData);
                }
            } catch (error) {
                log('❌ 请求错误: ' + error.message);
            }
        }
        
        // 自动执行测试
        testAPI();
    </script>
</body>
</html>