# TRONèƒ½é‡ç§Ÿèµç³»ç»Ÿ - æ ¸å¿ƒæ¨¡å—æŠ€æœ¯æ¶æ„æ–‡æ¡£

> **æ–‡æ¡£ç±»å‹**: æŠ€æœ¯æ¶æ„æ–‡æ¡£  
> **åˆ›å»ºæ—¥æœŸ**: 2024-12-19  
> **çŠ¶æ€**: ğŸš¨ ç´§æ€¥å¼€å‘  
> **æŠ€æœ¯è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ  

## 1. æ¶æ„è®¾è®¡

### 1.1 æ•´ä½“ç³»ç»Ÿæ¶æ„

```mermaid
graph TD
    A[Telegramç”¨æˆ·] --> B[Telegram Bot API]
    B --> C[æœºå™¨äººæœåŠ¡å±‚]
    C --> D[ä¸šåŠ¡é€»è¾‘å±‚]
    D --> E[æ•°æ®è®¿é—®å±‚]
    
    subgraph "æ ¸å¿ƒæœåŠ¡æ¨¡å—"
        F[è®¢å•ç®¡ç†æœåŠ¡]
        G[æ”¯ä»˜ç›‘æ§æœåŠ¡]
        H[èƒ½é‡æ± ç®¡ç†æœåŠ¡]
        I[TRONåŒºå—é“¾æœåŠ¡]
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡"
        J[TRONç½‘ç»œ]
        K[TronGrid API]
    end
    
    subgraph "æ•°æ®å­˜å‚¨å±‚"
        L[PostgreSQLæ•°æ®åº“]
        M[Redisç¼“å­˜]
    end
    
    C --> F
    C --> G
    F --> H
    F --> I
    G --> I
    H --> I
    I --> J
    I --> K
    
    F --> L
    G --> L
    H --> L
    I --> L
    C --> M
    H --> M
```

### 1.2 å¾®æœåŠ¡æ¶æ„è®¾è®¡

```mermaid
graph TD
    A[API Gateway] --> B[Telegram Bot Service]
    A --> C[Order Management Service]
    A --> D[Payment Service]
    A --> E[Energy Pool Service]
    A --> F[TRON Blockchain Service]
    
    B --> G[Message Queue]
    C --> G
    D --> G
    E --> G
    F --> G
    
    G --> H[Event Bus]
    H --> I[Notification Service]
    H --> J[Monitoring Service]
    
    subgraph "æ•°æ®å±‚"
        K[Orders DB]
        L[Users DB]
        M[Energy Pools DB]
        N[Transactions DB]
        O[Redis Cache]
    end
    
    C --> K
    B --> L
    E --> M
    F --> N
    B --> O
    E --> O
```

## 2. æŠ€æœ¯æ ˆæè¿°

### 2.1 æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **å‰ç«¯**: æ—  (çº¯Telegramæœºå™¨äººäº¤äº’)
- **åç«¯**: Node.js + Express.js + TypeScript
- **æ•°æ®åº“**: PostgreSQL (ä¸»æ•°æ®åº“) + Redis (ç¼“å­˜å’Œä¼šè¯)
- **åŒºå—é“¾**: TronWeb SDK + TronGrid API
- **æ¶ˆæ¯é˜Ÿåˆ—**: Redis Pub/Sub + Bull Queue
- **ç›‘æ§**: è‡ªç ”ç›‘æ§ç³»ç»Ÿ + Winstonæ—¥å¿—

### 2.2 å…³é”®ä¾èµ–åŒ…

```json
{
  "dependencies": {
    "express": "^4.18.2",
    "node-telegram-bot-api": "^0.64.0",
    "tronweb": "^5.3.2",
    "pg": "^8.11.3",
    "redis": "^4.6.10",
    "bull": "^4.12.2",
    "winston": "^3.11.0",
    "crypto": "^1.0.1",
    "joi": "^17.11.0",
    "jsonwebtoken": "^9.0.2"
  }
}
```

## 3. è·¯ç”±å®šä¹‰

### 3.1 Telegramæœºå™¨äººè·¯ç”±

| è·¯ç”±ç±»å‹ | è·¯å¾„/å‘½ä»¤ | åŠŸèƒ½æè¿° |
|----------|-----------|----------|
| Webhook | /webhook/telegram | æ¥æ”¶Telegramæ¶ˆæ¯ |
| Command | /start | æœºå™¨äººå¯åŠ¨å’Œç”¨æˆ·æ³¨å†Œ |
| Command | /menu | æ˜¾ç¤ºä¸»èœå• |
| Command | /help | å¸®åŠ©ä¿¡æ¯ |
| Command | /balance | æŸ¥è¯¢ä½™é¢ |
| Command | /orders | è®¢å•å†å² |
| Callback | energy_package_* | èƒ½é‡åŒ…é€‰æ‹©å›è°ƒ |
| Callback | confirm_order_* | è®¢å•ç¡®è®¤å›è°ƒ |
| Callback | check_payment_* | æ”¯ä»˜çŠ¶æ€æ£€æŸ¥ |

### 3.2 å†…éƒ¨APIè·¯ç”±

| è·¯ç”± | æ–¹æ³• | åŠŸèƒ½æè¿° |
|------|------|----------|
| /api/orders | POST | åˆ›å»ºè®¢å• |
| /api/orders/:id | GET | è·å–è®¢å•è¯¦æƒ… |
| /api/orders/:id/payment | POST | å¤„ç†æ”¯ä»˜ |
| /api/energy-pools | GET | è·å–èƒ½é‡æ± çŠ¶æ€ |
| /api/energy-pools/allocate | POST | åˆ†é…èƒ½é‡æ±  |
| /api/tron/delegate | POST | æ‰§è¡Œèƒ½é‡å§”æ‰˜ |
| /api/tron/balance/:address | GET | æŸ¥è¯¢åœ°å€ä½™é¢ |
| /api/payments/monitor | POST | å¯åŠ¨æ”¯ä»˜ç›‘æ§ |

## 4. APIå®šä¹‰

### 4.1 Telegramæœºå™¨äººAPI

#### ç”¨æˆ·æ³¨å†Œ
```typescript
interface TelegramUser {
  id: number;
  username?: string;
  first_name: string;
  last_name?: string;
  language_code?: string;
}

interface UserRegistration {
  telegram_id: number;
  username?: string;
  first_name: string;
  created_at: Date;
}
```

#### è®¢å•åˆ›å»º
```typescript
interface OrderRequest {
  user_id: string;
  energy_package_id: string;
  quantity: number;
  recipient_address: string;
}

interface OrderResponse {
  order_id: string;
  total_amount: number;
  payment_address: string;
  expires_at: Date;
}
```

### 4.2 TRONåŒºå—é“¾API

#### èƒ½é‡å§”æ‰˜
```typescript
interface DelegateEnergyRequest {
  from_address: string;
  to_address: string;
  amount: number;
  private_key: string;
}

interface DelegateEnergyResponse {
  transaction_id: string;
  status: 'pending' | 'confirmed' | 'failed';
  block_number?: number;
  energy_delegated: number;
}
```

#### ä½™é¢æŸ¥è¯¢
```typescript
interface BalanceQuery {
  address: string;
}

interface BalanceResponse {
  trx_balance: number;
  energy: number;
  bandwidth: number;
  delegated_energy: number;
}
```

### 4.3 èƒ½é‡æ± ç®¡ç†API

#### æ± çŠ¶æ€æŸ¥è¯¢
```typescript
interface EnergyPoolStatus {
  pool_id: string;
  name: string;
  total_energy: number;
  available_energy: number;
  reserved_energy: number;
  utilization_rate: number;
  status: 'active' | 'inactive' | 'maintenance';
}
```

#### èƒ½é‡åˆ†é…
```typescript
interface EnergyAllocationRequest {
  required_energy: number;
  recipient_address: string;
  priority: 'low' | 'normal' | 'high';
}

interface EnergyAllocationResponse {
  allocated_pools: {
    pool_id: string;
    allocated_energy: number;
    estimated_cost: number;
  }[];
  total_cost: number;
  estimated_completion_time: Date;
}
```

### 4.4 æ”¯ä»˜ç›‘æ§API

#### æ”¯ä»˜ç›‘æ§å¯åŠ¨
```typescript
interface PaymentMonitorRequest {
  order_id: string;
  payment_address: string;
  expected_amount: number;
  timeout_minutes: number;
}

interface PaymentMonitorResponse {
  monitor_id: string;
  status: 'monitoring' | 'completed' | 'timeout';
  confirmed_amount?: number;
  transaction_hash?: string;
}
```

## 5. æœåŠ¡å™¨æ¶æ„å›¾

### 5.1 æœåŠ¡åˆ†å±‚æ¶æ„

```mermaid
graph TD
    A[Presentation Layer] --> B[Business Logic Layer]
    B --> C[Data Access Layer]
    C --> D[Database Layer]
    
    subgraph "Presentation Layer"
        E[Telegram Bot Handler]
        F[Webhook Controller]
        G[API Controller]
    end
    
    subgraph "Business Logic Layer"
        H[Order Service]
        I[Payment Service]
        J[Energy Pool Service]
        K[TRON Service]
        L[User Service]
    end
    
    subgraph "Data Access Layer"
        M[Order Repository]
        N[User Repository]
        O[Energy Pool Repository]
        P[Transaction Repository]
    end
    
    subgraph "Database Layer"
        Q[PostgreSQL]
        R[Redis]
    end
    
    E --> H
    E --> L
    F --> H
    F --> I
    G --> J
    G --> K
    
    H --> M
    I --> P
    J --> O
    L --> N
    
    M --> Q
    N --> Q
    O --> Q
    P --> Q
    
    H --> R
    I --> R
    J --> R
```

### 5.2 æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„

```mermaid
graph TD
    A[Telegram Bot] --> B[Message Queue]
    C[Payment Monitor] --> B
    D[Energy Pool Manager] --> B
    
    B --> E[Order Processing Worker]
    B --> F[Payment Processing Worker]
    B --> G[Energy Delegation Worker]
    B --> H[Notification Worker]
    
    E --> I[Order Service]
    F --> J[Payment Service]
    G --> K[TRON Service]
    H --> L[Notification Service]
    
    subgraph "Queue Types"
        M[High Priority Queue]
        N[Normal Priority Queue]
        O[Low Priority Queue]
        P[Dead Letter Queue]
    end
    
    B --> M
    B --> N
    B --> O
    B --> P
```

## 6. æ•°æ®æ¨¡å‹

### 6.1 æ•°æ®æ¨¡å‹å®šä¹‰

```mermaid
erDiagram
    USERS ||--o{ ORDERS : places
    ORDERS ||--|| PAYMENTS : has
    ORDERS ||--o{ ENERGY_DELEGATIONS : contains
    ENERGY_POOLS ||--o{ ENERGY_DELEGATIONS : provides
    ENERGY_PACKAGES ||--o{ ORDERS : selected
    
    USERS {
        uuid id PK
        bigint telegram_id UK
        string username
        string first_name
        string language_code
        timestamp created_at
        timestamp updated_at
    }
    
    ORDERS {
        uuid id PK
        uuid user_id FK
        uuid energy_package_id FK
        integer quantity
        string recipient_address
        decimal total_amount
        string status
        timestamp created_at
        timestamp expires_at
    }
    
    PAYMENTS {
        uuid id PK
        uuid order_id FK
        string payment_address
        decimal expected_amount
        decimal confirmed_amount
        string transaction_hash
        string status
        timestamp confirmed_at
    }
    
    ENERGY_POOLS {
        uuid id PK
        string name
        string tron_address
        text encrypted_private_key
        bigint total_energy
        bigint available_energy
        bigint reserved_energy
        string status
        decimal cost_per_energy
    }
    
    ENERGY_DELEGATIONS {
        uuid id PK
        uuid order_id FK
        uuid energy_pool_id FK
        string recipient_address
        bigint energy_amount
        string transaction_hash
        string status
        timestamp delegated_at
    }
    
    ENERGY_PACKAGES {
        uuid id PK
        string name
        bigint energy_amount
        decimal price
        integer duration_hours
        boolean is_active
    }
```

### 6.2 æ•°æ®å®šä¹‰è¯­è¨€

#### Telegramæœºå™¨äººç”¨æˆ·ä¼šè¯è¡¨
```sql
-- Telegramæœºå™¨äººç”¨æˆ·ä¼šè¯è¡¨
CREATE TABLE telegram_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    telegram_id BIGINT NOT NULL,
    user_id UUID REFERENCES users(id),
    current_state VARCHAR(50) DEFAULT 'idle',
    session_data JSONB DEFAULT '{}',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() + INTERVAL '24 hours'
);

CREATE INDEX idx_telegram_sessions_telegram_id ON telegram_sessions(telegram_id);
CREATE INDEX idx_telegram_sessions_expires_at ON telegram_sessions(expires_at);
```

#### æ”¯ä»˜ç›‘æ§è¡¨
```sql
-- æ”¯ä»˜ç›‘æ§è¡¨
CREATE TABLE payment_monitors (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id UUID NOT NULL REFERENCES orders(id),
    payment_address VARCHAR(34) NOT NULL,
    expected_amount DECIMAL(20,6) NOT NULL,
    monitor_status VARCHAR(20) DEFAULT 'monitoring',
    last_check_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    timeout_at TIMESTAMP WITH TIME ZONE NOT NULL
);

CREATE INDEX idx_payment_monitors_address ON payment_monitors(payment_address);
CREATE INDEX idx_payment_monitors_status ON payment_monitors(monitor_status);
```

#### èƒ½é‡æ± è°ƒåº¦æ—¥å¿—è¡¨
```sql
-- èƒ½é‡æ± è°ƒåº¦æ—¥å¿—è¡¨
CREATE TABLE energy_pool_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    pool_id UUID NOT NULL REFERENCES energy_pools(id),
    action VARCHAR(50) NOT NULL,
    energy_amount BIGINT,
    recipient_address VARCHAR(34),
    transaction_hash VARCHAR(64),
    status VARCHAR(20) NOT NULL,
    error_message TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_energy_pool_logs_pool_id ON energy_pool_logs(pool_id);
CREATE INDEX idx_energy_pool_logs_created_at ON energy_pool_logs(created_at DESC);
```

#### TRONäº¤æ˜“ç›‘æ§è¡¨
```sql
-- TRONäº¤æ˜“ç›‘æ§è¡¨
CREATE TABLE tron_transactions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    transaction_hash VARCHAR(64) UNIQUE NOT NULL,
    from_address VARCHAR(34) NOT NULL,
    to_address VARCHAR(34) NOT NULL,
    transaction_type VARCHAR(20) NOT NULL, -- 'transfer', 'delegate', 'undelegate'
    amount DECIMAL(20,6),
    energy_amount BIGINT,
    block_number BIGINT,
    confirmation_count INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    confirmed_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_tron_transactions_hash ON tron_transactions(transaction_hash);
CREATE INDEX idx_tron_transactions_status ON tron_transactions(status);
CREATE INDEX idx_tron_transactions_addresses ON tron_transactions(from_address, to_address);
```

#### ç³»ç»Ÿé…ç½®è¡¨
```sql
-- ç³»ç»Ÿé…ç½®è¡¨
CREATE TABLE system_configs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    config_key VARCHAR(100) UNIQUE NOT NULL,
    config_value TEXT NOT NULL,
    config_type VARCHAR(20) DEFAULT 'string', -- 'string', 'number', 'boolean', 'json'
    description TEXT,
    is_encrypted BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆå§‹åŒ–ç³»ç»Ÿé…ç½®
INSERT INTO system_configs (config_key, config_value, config_type, description) VALUES
('tron.network', 'shasta', 'string', 'TRONç½‘ç»œç±»å‹'),
('tron.api_key', '', 'string', 'TronGrid APIå¯†é’¥'),
('telegram.bot_token', '', 'string', 'Telegramæœºå™¨äººToken'),
('payment.confirmation_blocks', '19', 'number', 'æ”¯ä»˜ç¡®è®¤æ‰€éœ€åŒºå—æ•°'),
('energy.min_delegation_amount', '1000', 'number', 'æœ€å°èƒ½é‡å§”æ‰˜æ•°é‡'),
('pool.health_check_interval', '300', 'number', 'èƒ½é‡æ± å¥åº·æ£€æŸ¥é—´éš”(ç§’)'),
('order.timeout_minutes', '30', 'number', 'è®¢å•è¶…æ—¶æ—¶é—´(åˆ†é’Ÿ)');
```

## 7. å…³é”®æŠ€æœ¯å®ç°

### 7.1 Telegramæœºå™¨äººçŠ¶æ€ç®¡ç†

```typescript
// ç”¨æˆ·çŠ¶æ€ç®¡ç†
class TelegramSessionManager {
  private redis: Redis;
  
  async getUserState(telegramId: number): Promise<UserState> {
    const sessionKey = `telegram:session:${telegramId}`;
    const sessionData = await this.redis.get(sessionKey);
    return sessionData ? JSON.parse(sessionData) : { state: 'idle' };
  }
  
  async updateUserState(telegramId: number, state: UserState): Promise<void> {
    const sessionKey = `telegram:session:${telegramId}`;
    await this.redis.setex(sessionKey, 3600, JSON.stringify(state));
  }
}

// æ¶ˆæ¯å¤„ç†è·¯ç”±
class MessageRouter {
  async handleMessage(message: TelegramMessage): Promise<void> {
    const userState = await this.sessionManager.getUserState(message.from.id);
    
    switch (userState.state) {
      case 'idle':
        return this.handleIdleState(message);
      case 'selecting_package':
        return this.handlePackageSelection(message);
      case 'entering_address':
        return this.handleAddressInput(message);
      case 'confirming_order':
        return this.handleOrderConfirmation(message);
      default:
        return this.handleUnknownState(message);
    }
  }
}
```

### 7.2 TRONåŒºå—é“¾é›†æˆ

```typescript
// TronWebé…ç½®å’Œè¿æ¥ç®¡ç†
class TronService {
  private tronWeb: TronWeb;
  private connectionPool: TronWeb[];
  
  constructor() {
    this.initializeTronWeb();
    this.setupConnectionPool();
  }
  
  private initializeTronWeb(): void {
    this.tronWeb = new TronWeb({
      fullHost: 'https://api.shasta.trongrid.io',
      headers: { 'TRON-PRO-API-KEY': process.env.TRON_API_KEY },
      privateKey: process.env.MASTER_PRIVATE_KEY
    });
  }
  
  async delegateEnergy(params: DelegateEnergyParams): Promise<DelegateResult> {
    try {
      const transaction = await this.tronWeb.transactionBuilder.delegateResource(
        params.amount,
        params.toAddress,
        'ENERGY',
        params.fromAddress
      );
      
      const signedTx = await this.tronWeb.trx.sign(transaction, params.privateKey);
      const result = await this.tronWeb.trx.sendRawTransaction(signedTx);
      
      return {
        transactionId: result.txid,
        status: 'pending',
        energyDelegated: params.amount
      };
    } catch (error) {
      throw new TronServiceError(`èƒ½é‡å§”æ‰˜å¤±è´¥: ${error.message}`);
    }
  }
}
```

### 7.3 èƒ½é‡æ± ç®¡ç†ç®—æ³•

```typescript
// èƒ½é‡æ± è°ƒåº¦ç®—æ³•
class EnergyPoolScheduler {
  async allocateOptimalPools(requirement: EnergyRequirement): Promise<AllocationResult> {
    const availablePools = await this.getAvailablePools();
    const sortedPools = this.sortPoolsByCostEfficiency(availablePools);
    
    const allocation: PoolAllocation[] = [];
    let remainingEnergy = requirement.energyAmount;
    
    for (const pool of sortedPools) {
      if (remainingEnergy <= 0) break;
      
      const allocatedEnergy = Math.min(remainingEnergy, pool.availableEnergy);
      if (allocatedEnergy > 0) {
        allocation.push({
          poolId: pool.id,
          allocatedEnergy,
          estimatedCost: allocatedEnergy * pool.costPerEnergy
        });
        remainingEnergy -= allocatedEnergy;
      }
    }
    
    if (remainingEnergy > 0) {
      throw new InsufficientEnergyError('å¯ç”¨èƒ½é‡ä¸è¶³');
    }
    
    return {
      allocations: allocation,
      totalCost: allocation.reduce((sum, a) => sum + a.estimatedCost, 0)
    };
  }
  
  private sortPoolsByCostEfficiency(pools: EnergyPool[]): EnergyPool[] {
    return pools.sort((a, b) => {
      // ç»¼åˆè€ƒè™‘æˆæœ¬ã€å¯ç”¨æ€§å’Œå¯é æ€§
      const scoreA = this.calculatePoolScore(a);
      const scoreB = this.calculatePoolScore(b);
      return scoreB - scoreA; // é™åºæ’åˆ—
    });
  }
}
```

### 7.4 æ”¯ä»˜ç›‘æ§ç³»ç»Ÿ

```typescript
// æ”¯ä»˜ç›‘æ§æœåŠ¡
class PaymentMonitorService {
  private monitoringJobs = new Map<string, NodeJS.Timeout>();
  
  async startMonitoring(params: PaymentMonitorParams): Promise<void> {
    const monitorId = `payment:${params.orderId}`;
    
    // å¯åŠ¨å®šæ—¶æ£€æŸ¥
    const intervalId = setInterval(async () => {
      await this.checkPaymentStatus(params);
    }, 30000); // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    
    this.monitoringJobs.set(monitorId, intervalId);
    
    // è®¾ç½®è¶…æ—¶
    setTimeout(() => {
      this.handlePaymentTimeout(params.orderId);
    }, params.timeoutMinutes * 60 * 1000);
  }
  
  private async checkPaymentStatus(params: PaymentMonitorParams): Promise<void> {
    try {
      const transactions = await this.tronService.getAddressTransactions(
        params.paymentAddress
      );
      
      for (const tx of transactions) {
        if (tx.value >= params.expectedAmount && tx.confirmations >= 19) {
          await this.confirmPayment(params.orderId, tx);
          this.stopMonitoring(params.orderId);
          break;
        }
      }
    } catch (error) {
      console.error('æ”¯ä»˜æ£€æŸ¥å¤±è´¥:', error);
    }
  }
}
```

## 8. éƒ¨ç½²å’Œè¿ç»´

### 8.1 Dockerå®¹å™¨åŒ–

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
```

### 8.2 ç¯å¢ƒé…ç½®

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://user:pass@db:5432/tron_energy
      - REDIS_URL=redis://redis:6379
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TRON_API_KEY=${TRON_API_KEY}
    depends_on:
      - db
      - redis
  
  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=tron_energy
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

---

**æ–‡æ¡£ç»´æŠ¤**: æŠ€æœ¯å›¢é˜Ÿ  
**æ›´æ–°é¢‘ç‡**: æ¯æ¬¡æ¶æ„å˜æ›´åæ›´æ–°  
**æŠ€æœ¯æ”¯æŒ**: å¼€å‘å›¢é˜Ÿè´Ÿè´£äºº