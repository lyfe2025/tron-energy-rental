# TRONèƒ½é‡ç§Ÿèµç³»ç»Ÿ - æ ¸å¿ƒæ¨¡å—å¼€å‘éœ€æ±‚æ–‡æ¡£

> **æ–‡æ¡£ç±»å‹**: äº§å“éœ€æ±‚æ–‡æ¡£  
> **åˆ›å»ºæ—¥æœŸ**: 2024-12-19  
> **çŠ¶æ€**: ğŸš¨ ç´§æ€¥å¼€å‘  
> **ä¼˜å…ˆçº§**: P0 - æœ€é«˜ä¼˜å…ˆçº§  

## 1. äº§å“æ¦‚è¿°

æœ¬æ–‡æ¡£ä¸“é—¨é’ˆå¯¹TRONèƒ½é‡ç§Ÿèµç³»ç»Ÿä¸­å››ä¸ªå®Œå…¨ç¼ºå¤±çš„æ ¸å¿ƒæ¨¡å—è¿›è¡Œè¯¦ç»†éœ€æ±‚åˆ†æã€‚è¿™äº›æ¨¡å—æ˜¯ç³»ç»Ÿèƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„åŸºç¡€ï¼Œç›®å‰å®Œæˆåº¦ä¸º0%ï¼Œéœ€è¦ç«‹å³å¼€å‘ã€‚

**æ ¸å¿ƒç¼ºå¤±æ¨¡å—**:
- Telegramæœºå™¨äººé›†æˆ - ç”¨æˆ·äº¤äº’çš„å”¯ä¸€å…¥å£
- TRONåŒºå—é“¾é›†æˆ - ä¸šåŠ¡æ ¸å¿ƒåŠŸèƒ½å®ç°
- èƒ½é‡æ± ç®¡ç†ç³»ç»Ÿ - è‡ªåŠ¨åŒ–è¿è¥çš„å…³é”®
- æ”¯ä»˜ä¸äº¤æ˜“å¤„ç† - èµ„é‡‘å®‰å…¨å’Œä¸šåŠ¡é—­ç¯

## 2. æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

### 2.1 Telegramæœºå™¨äººæ¨¡å—

#### åŠŸèƒ½æ¦‚è¿°
Telegramæœºå™¨äººæ˜¯ç”¨æˆ·ä¸ç³»ç»Ÿäº¤äº’çš„å”¯ä¸€ç•Œé¢ï¼Œå¿…é¡»æä¾›å®Œæ•´çš„èƒ½é‡ç§ŸèµæœåŠ¡æµç¨‹ã€‚

#### æ ¸å¿ƒé¡µé¢å’ŒåŠŸèƒ½
1. **æœºå™¨äººå¯åŠ¨é¡µé¢**: æ¬¢è¿æ¶ˆæ¯ã€ç”¨æˆ·æ³¨å†Œã€åŸºç¡€è¯´æ˜
2. **ä¸»èœå•é¡µé¢**: èƒ½é‡åŒ…æµè§ˆã€è®¢å•æŸ¥è¯¢ã€è´¦æˆ·ç®¡ç†ã€å¸®åŠ©æ”¯æŒ
3. **èƒ½é‡åŒ…é€‰æ‹©é¡µé¢**: å¥—é¤å±•ç¤ºã€ä»·æ ¼å¯¹æ¯”ã€è§„æ ¼è¯´æ˜
4. **è®¢å•ç¡®è®¤é¡µé¢**: è®¢å•è¯¦æƒ…ã€ä»·æ ¼è®¡ç®—ã€æ”¯ä»˜æ–¹å¼
5. **æ”¯ä»˜é¡µé¢**: æ”¯ä»˜åœ°å€ç”Ÿæˆã€æ”¯ä»˜çŠ¶æ€è·Ÿè¸ª
6. **è®¢å•çŠ¶æ€é¡µé¢**: å§”æ‰˜è¿›åº¦ã€å®Œæˆé€šçŸ¥ã€å†å²è®°å½•
7. **ç”¨æˆ·ä¸­å¿ƒé¡µé¢**: ä¸ªäººä¿¡æ¯ã€ä½™é¢æŸ¥è¯¢ã€æ¨èç 

#### è¯¦ç»†åŠŸèƒ½è§„æ ¼

| é¡µé¢åç§° | æ¨¡å—åç§° | åŠŸèƒ½æè¿° |
|----------|----------|----------|
| æœºå™¨äººå¯åŠ¨ | ç”¨æˆ·æ³¨å†Œ | è‡ªåŠ¨ç»‘å®šTelegramç”¨æˆ·IDåˆ°usersè¡¨ï¼Œåˆ›å»ºç³»ç»Ÿè´¦æˆ·ï¼Œå‘é€æ¬¢è¿æ¶ˆæ¯ |
| æœºå™¨äººå¯åŠ¨ | å‘½ä»¤å¤„ç† | å¤„ç†/start, /help, /menuç­‰åŸºç¡€å‘½ä»¤ï¼Œè®°å½•åˆ°bot_usersè¡¨ |
| ä¸»èœå• | å¯¼èˆªèœå• | å†…è”é”®ç›˜å¯¼èˆªï¼Œå¿«é€Ÿè®¿é—®å„åŠŸèƒ½æ¨¡å—ï¼ŒåŸºäºbotsè¡¨é…ç½® |
| ä¸»èœå• | çŠ¶æ€æ˜¾ç¤º | æ˜¾ç¤ºç”¨æˆ·å½“å‰è®¢å•çŠ¶æ€ã€USDT/TRXä½™é¢ä¿¡æ¯ |
| èƒ½é‡åŒ…é€‰æ‹© | å¥—é¤å±•ç¤º | ä»energy_packagesè¡¨åŠ¨æ€åŠ è½½å¯ç”¨èƒ½é‡åŒ…ï¼Œæ˜¾ç¤ºä»·æ ¼å’Œè§„æ ¼ |
| èƒ½é‡åŒ…é€‰æ‹© | ä»·æ ¼è®¡ç®— | åŸºäºprice_configsè¡¨å®æ—¶è®¡ç®—æ€»ä»·ï¼Œæ”¯æŒæ•°é‡é€‰æ‹© |
| è®¢å•ç¡®è®¤ | è®¢å•ç”Ÿæˆ | åˆ›å»ºordersè¡¨è®°å½•ï¼Œç”Ÿæˆå”¯ä¸€order_number |
| è®¢å•ç¡®è®¤ | åœ°å€éªŒè¯ | éªŒè¯ç”¨æˆ·è¾“å…¥çš„TRONåœ°å€æ ¼å¼ï¼Œæ›´æ–°target_addresså­—æ®µ |
| æ”¯ä»˜é¡µé¢ | æ”¯ä»˜åœ°å€ | ç”Ÿæˆä¸“ç”¨æ”¯ä»˜åœ°å€ï¼Œæ˜¾ç¤ºäºŒç»´ç ï¼Œæ›´æ–°payment_method |
| æ”¯ä»˜é¡µé¢ | çŠ¶æ€ç›‘æ§ | å®æ—¶ç›‘æ§æ”¯ä»˜çŠ¶æ€ï¼Œè‡ªåŠ¨ç¡®è®¤ï¼Œæ›´æ–°payment_status |
| è®¢å•çŠ¶æ€ | è¿›åº¦è·Ÿè¸ª | æ˜¾ç¤ºèƒ½é‡å§”æ‰˜è¿›åº¦ï¼Œä»energy_transactionsè¡¨è·å–çŠ¶æ€ |
| è®¢å•çŠ¶æ€ | å†å²æŸ¥è¯¢ | æŸ¥çœ‹å†å²è®¢å•ï¼Œæ”¯æŒåˆ†é¡µæµè§ˆï¼ŒåŸºäºordersè¡¨æŸ¥è¯¢ |

### 2.2 TRONåŒºå—é“¾é›†æˆæ¨¡å—

#### åŠŸèƒ½æ¦‚è¿°
å®ç°ä¸TRONç½‘ç»œçš„å®Œæ•´é›†æˆï¼Œæ”¯æŒèƒ½é‡å§”æ‰˜ã€é’±åŒ…ç®¡ç†ã€äº¤æ˜“ç›‘æ§ç­‰æ ¸å¿ƒåŒºå—é“¾åŠŸèƒ½ã€‚

#### æ ¸å¿ƒåŠŸèƒ½ç»„ä»¶
1. **TronWeb SDKé›†æˆ**: è¿æ¥TRONç½‘ç»œï¼Œæ”¯æŒä¸»ç½‘å’Œæµ‹è¯•ç½‘åˆ‡æ¢
2. **é’±åŒ…ç®¡ç†æœåŠ¡**: åˆ›å»ºå’Œç®¡ç†å¤šä¸ªé’±åŒ…ï¼Œç§é’¥å®‰å…¨å­˜å‚¨
3. **èƒ½é‡å§”æ‰˜åŠŸèƒ½**: å®ç°delegateResourceåˆçº¦è°ƒç”¨
4. **äº¤æ˜“ç›‘æ§ç³»ç»Ÿ**: å®æ—¶ç›‘æ§äº¤æ˜“çŠ¶æ€å’Œç¡®è®¤
5. **åœ°å€éªŒè¯å·¥å…·**: éªŒè¯TRONåœ°å€æ ¼å¼å’Œæœ‰æ•ˆæ€§

#### è¯¦ç»†åŠŸèƒ½è§„æ ¼

| ç»„ä»¶åç§° | æ¨¡å—åç§° | åŠŸèƒ½æè¿° |
|----------|----------|----------|
| SDKé›†æˆ | ç½‘ç»œè¿æ¥ | é…ç½®Shastaæµ‹è¯•ç½‘ï¼Œå»ºç«‹ç¨³å®šè¿æ¥ï¼Œæ”¯æŒè¿æ¥æ±  |
| SDKé›†æˆ | é”™è¯¯å¤„ç† | ç½‘ç»œå¼‚å¸¸é‡è¯•ï¼Œè¿æ¥çŠ¶æ€ç›‘æ§ï¼Œè‡ªåŠ¨é‡è¿æœºåˆ¶ |
| é’±åŒ…ç®¡ç† | é’±åŒ…åˆ›å»º | ç”Ÿæˆæ–°é’±åŒ…ï¼Œæ”¯æŒHDé’±åŒ…ï¼Œç§é’¥AES-256åŠ å¯† |
| é’±åŒ…ç®¡ç† | ä½™é¢æŸ¥è¯¢ | æŸ¥è¯¢TRXä½™é¢ã€èƒ½é‡ã€å¸¦å®½ç­‰èµ„æºä¿¡æ¯ |
| èƒ½é‡å§”æ‰˜ | å§”æ‰˜æ‰§è¡Œ | è°ƒç”¨delegateResourceåˆçº¦ï¼Œæ‰§è¡Œèƒ½é‡å§”æ‰˜ |
| èƒ½é‡å§”æ‰˜ | å–æ¶ˆå§”æ‰˜ | å®ç°undelegateResourceï¼Œç®¡ç†è§£å†»æœŸ |
| äº¤æ˜“ç›‘æ§ | çŠ¶æ€è·Ÿè¸ª | ç›‘æ§äº¤æ˜“ç¡®è®¤çŠ¶æ€ï¼Œè®°å½•åŒºå—ç¡®è®¤æ•° |
| äº¤æ˜“ç›‘æ§ | äº‹ä»¶ç›‘å¬ | è®¢é˜…åŒºå—é“¾äº‹ä»¶ï¼Œå®æ—¶åŒæ­¥çŠ¶æ€å˜åŒ– |

### 2.3 èƒ½é‡æ± ç®¡ç†ç³»ç»Ÿ

#### åŠŸèƒ½æ¦‚è¿°
å®ç°æ™ºèƒ½åŒ–çš„èƒ½é‡æ± è°ƒåº¦å’Œç®¡ç†ï¼Œè‡ªåŠ¨ä¼˜åŒ–æˆæœ¬å’Œæ•ˆç‡ï¼Œå‡å°‘äººå·¥å¹²é¢„ã€‚

#### æ ¸å¿ƒç®¡ç†åŠŸèƒ½
1. **èƒ½é‡æ± ç›‘æ§**: å®æ—¶ç›‘æ§å„æ± çŠ¶æ€ã€ä½™é¢ã€ä½¿ç”¨ç‡
2. **è‡ªåŠ¨è°ƒåº¦ç®—æ³•**: æ ¹æ®éœ€æ±‚è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜èƒ½é‡æ± 
3. **æˆæœ¬ä¼˜åŒ–**: æœ€ä½æˆæœ¬è·¯å¾„é€‰æ‹©ï¼Œåˆ©æ¶¦æœ€å¤§åŒ–
4. **åº“å­˜é¢„è­¦**: èƒ½é‡ä¸è¶³è‡ªåŠ¨é¢„è­¦å’Œè¡¥å……
5. **æ€§èƒ½åˆ†æ**: ä½¿ç”¨æ•ˆç‡åˆ†æå’Œä¼˜åŒ–å»ºè®®

#### è¯¦ç»†åŠŸèƒ½è§„æ ¼

| åŠŸèƒ½æ¨¡å— | å­åŠŸèƒ½ | åŠŸèƒ½æè¿° |
|----------|--------|----------|
| çŠ¶æ€ç›‘æ§ | å®æ—¶ç›‘æ§ | ç›‘æ§energy_poolsè¡¨ä¸­å„æ± ä½™é¢ã€å¯ç”¨é‡ã€å§”æ‰˜çŠ¶æ€ |
| çŠ¶æ€ç›‘æ§ | å¥åº·æ£€æŸ¥ | æ£€æµ‹å¼‚å¸¸æ± ï¼Œè‡ªåŠ¨æ›´æ–°statuså­—æ®µï¼Œå®ç°éš”ç¦»å’Œæ¢å¤æœºåˆ¶ |
| è‡ªåŠ¨è°ƒåº¦ | è´Ÿè½½å‡è¡¡ | æ ¹æ®æ± priorityå’Œavailable_energyè‡ªåŠ¨åˆ†é…æ–°è®¢å• |
| è‡ªåŠ¨è°ƒåº¦ | æ™ºèƒ½é€‰æ‹© | åŸºäºcost_per_energyã€é€Ÿåº¦ã€å¯é æ€§é€‰æ‹©æœ€ä¼˜æ±  |
| æˆæœ¬ä¼˜åŒ– | æˆæœ¬è®¡ç®— | å®æ—¶è®¡ç®—å„æ± æˆæœ¬ï¼ŒåŸºäºcost_per_energyé€‰æ‹©æœ€ä½æˆæœ¬æ–¹æ¡ˆ |
| æˆæœ¬ä¼˜åŒ– | åˆ©æ¶¦åˆ†æ | åˆ†æå„æ± åˆ©æ¶¦ç‡ï¼Œä¼˜åŒ–price_configsè¡¨å®šä»·ç­–ç•¥ |
| åº“å­˜ç®¡ç† | é¢„è­¦ç³»ç»Ÿ | åŸºäºavailable_energyå’Œdaily_limitå®ç°å¤šçº§é˜ˆå€¼é¢„è­¦ |
| åº“å­˜ç®¡ç† | è‡ªåŠ¨è¡¥å…… | é¢„è®¾è§„åˆ™è‡ªåŠ¨è¡¥å……èƒ½é‡ï¼Œæ›´æ–°total_energyå­—æ®µä¿è¯ä¾›åº” |

### 2.4 æ”¯ä»˜ä¸äº¤æ˜“å¤„ç†æ¨¡å—

#### åŠŸèƒ½æ¦‚è¿°
å®ç°å®‰å…¨å¯é çš„æ”¯ä»˜å¤„ç†ç³»ç»Ÿï¼Œæ”¯æŒTRONç½‘ç»œæ”¯ä»˜ç›‘æ§ã€è®¢å•è‡ªåŠ¨å¤„ç†ã€é£é™©æ§åˆ¶ã€‚

#### æ ¸å¿ƒæ”¯ä»˜åŠŸèƒ½
1. **æ”¯ä»˜ç›‘æ§æœåŠ¡**: å®æ—¶ç›‘æ§TRONè½¬è´¦ï¼Œè‡ªåŠ¨ç¡®è®¤æ”¯ä»˜
2. **è®¢å•è‡ªåŠ¨å¤„ç†**: æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨æ‰§è¡Œèƒ½é‡å§”æ‰˜
3. **é£é™©æ§åˆ¶ç³»ç»Ÿ**: é˜²é‡å¤æ”¯ä»˜ã€è¶…æ—¶å¤„ç†ã€å¼‚å¸¸æ£€æµ‹
4. **ä»·æ ¼è®¡ç®—å¼•æ“**: åŠ¨æ€å®šä»·ã€å®æ—¶æ±‡ç‡ã€æˆæœ¬è®¡ç®—
5. **é€šçŸ¥æœåŠ¡**: æ”¯ä»˜çŠ¶æ€å®æ—¶é€šçŸ¥ç”¨æˆ·

#### è¯¦ç»†åŠŸèƒ½è§„æ ¼

| åŠŸèƒ½æ¨¡å— | å­åŠŸèƒ½ | åŠŸèƒ½æè¿° |
|----------|--------|----------|
| æ”¯ä»˜ç›‘æ§ | åœ°å€ç›‘æ§ | ç›‘æ§ä¸“ç”¨æ”¯ä»˜åœ°å€çš„è½¬è´¦è®°å½•ï¼Œæ›´æ–°ordersè¡¨transaction_id |
| æ”¯ä»˜ç›‘æ§ | è‡ªåŠ¨ç¡®è®¤ | è¾¾åˆ°ç¡®è®¤æ•°åè‡ªåŠ¨ç¡®è®¤æ”¯ä»˜ï¼Œæ›´æ–°payment_statuså­—æ®µ |
| è®¢å•å¤„ç† | çŠ¶æ€æœº | ç®¡ç†ordersè¡¨è®¢å•ç”Ÿå‘½å‘¨æœŸï¼ŒçŠ¶æ€æµè½¬ |
| è®¢å•å¤„ç† | è‡ªåŠ¨æ‰§è¡Œ | æ”¯ä»˜ç¡®è®¤åè‡ªåŠ¨è§¦å‘èƒ½é‡å§”æ‰˜ï¼Œåˆ›å»ºenergy_transactionsè®°å½• |
| é£é™©æ§åˆ¶ | é‡å¤æ£€æµ‹ | åŸºäºtransaction_idé˜²æ­¢é‡å¤æ”¯ä»˜ï¼Œå¹‚ç­‰æ€§ä¿è¯ |
| é£é™©æ§åˆ¶ | è¶…æ—¶å¤„ç† | åŸºäºexpires_atå­—æ®µè¶…æ—¶è®¢å•è‡ªåŠ¨å–æ¶ˆï¼Œèµ„æºé‡Šæ”¾ |
| ä»·æ ¼è®¡ç®— | åŠ¨æ€å®šä»· | æ ¹æ®price_configsè¡¨åŠ¨æ€è°ƒæ•´ä»·æ ¼ |
| ä»·æ ¼è®¡ç®— | æˆæœ¬åˆ†æ | åŸºäºenergy_poolsè¡¨cost_per_energyå®æ—¶è®¡ç®—æˆæœ¬ï¼Œä¿è¯åˆ©æ¶¦ç‡ |

## 3. æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 3.1 ç”¨æˆ·è´­ä¹°èƒ½é‡æµç¨‹

ç”¨æˆ·é€šè¿‡Telegramæœºå™¨äººå®Œæˆæ•´ä¸ªè´­ä¹°æµç¨‹ï¼š

1. ç”¨æˆ·å‘é€/startå‘½ä»¤å¯åŠ¨æœºå™¨äºº
2. ç³»ç»Ÿè‡ªåŠ¨æ³¨å†Œç”¨æˆ·è´¦æˆ·ï¼Œæ˜¾ç¤ºä¸»èœå•
3. ç”¨æˆ·é€‰æ‹©"è´­ä¹°èƒ½é‡"ï¼Œæµè§ˆå¯ç”¨èƒ½é‡åŒ…
4. ç”¨æˆ·é€‰æ‹©åˆé€‚çš„èƒ½é‡åŒ…å’Œæ•°é‡
5. ç”¨æˆ·è¾“å…¥æ¥æ”¶èƒ½é‡çš„TRONåœ°å€
6. ç³»ç»Ÿç”Ÿæˆè®¢å•ï¼Œè®¡ç®—æ€»ä»·ï¼Œæ˜¾ç¤ºæ”¯ä»˜ä¿¡æ¯
7. ç”¨æˆ·å‘æŒ‡å®šåœ°å€è½¬è´¦æ”¯ä»˜
8. ç³»ç»Ÿç›‘æ§åˆ°æ”¯ä»˜åè‡ªåŠ¨ç¡®è®¤è®¢å•
9. èƒ½é‡æ± ç®¡ç†ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ± æ‰§è¡Œå§”æ‰˜
10. TRONåŒºå—é“¾é›†æˆæ¨¡å—æ‰§è¡Œèƒ½é‡å§”æ‰˜
11. ç³»ç»Ÿé€šçŸ¥ç”¨æˆ·å§”æ‰˜å®Œæˆï¼Œæä¾›äº¤æ˜“å“ˆå¸Œ

### 3.2 ç³»ç»Ÿè‡ªåŠ¨åŒ–è¿è¥æµç¨‹

ç³»ç»Ÿåå°è‡ªåŠ¨åŒ–å¤„ç†æ‰€æœ‰è®¢å•ï¼š

```mermaid
graph TD
    A[è®¢å•åˆ›å»º] --> B[æ”¯ä»˜ç›‘æ§]
    B --> C{æ”¯ä»˜ç¡®è®¤?}
    C -->|æ˜¯| D[èƒ½é‡æ± è°ƒåº¦]
    C -->|å¦| E[è¶…æ—¶å–æ¶ˆ]
    D --> F[é€‰æ‹©æœ€ä¼˜æ± ]
    F --> G[æ‰§è¡Œèƒ½é‡å§”æ‰˜]
    G --> H[çŠ¶æ€åŒæ­¥]
    H --> I[ç”¨æˆ·é€šçŸ¥]
    E --> J[è®¢å•å…³é—­]
```

## 4. æŠ€æœ¯æ¶æ„è®¾è®¡

### 4.1 æ•´ä½“æ¶æ„

```mermaid
graph TD
    A[Telegramç”¨æˆ·] --> B[Telegram Bot API]
    B --> C[æœºå™¨äººæœåŠ¡]
    C --> D[è®¢å•ç®¡ç†API]
    D --> E[æ”¯ä»˜ç›‘æ§æœåŠ¡]
    D --> F[èƒ½é‡æ± ç®¡ç†]
    F --> G[TRONåŒºå—é“¾æœåŠ¡]
    E --> G
    G --> H[TRONç½‘ç»œ]
    
    subgraph "æ ¸å¿ƒæœåŠ¡å±‚"
        C
        D
        E
        F
        G
    end
    
    subgraph "æ•°æ®å±‚"
        I[PostgreSQL]
        J[Redisç¼“å­˜]
    end
    
    C --> I
    C --> J
    D --> I
    E --> I
    F --> I
```

### 4.2 æŠ€æœ¯æ ˆé€‰æ‹©

- **Telegramæœºå™¨äºº**: node-telegram-bot-api + Express.js
- **TRONé›†æˆ**: TronWeb SDK + TronGrid API
- **èƒ½é‡æ± ç®¡ç†**: Node.js + Redis + è°ƒåº¦ç®—æ³•
- **æ”¯ä»˜å¤„ç†**: äº‹ä»¶é©±åŠ¨æ¶æ„ + çŠ¶æ€æœº
- **æ•°æ®å­˜å‚¨**: PostgreSQL + Redis
- **ç›‘æ§**: è‡ªç ”ç›‘æ§ + æ—¥å¿—ç³»ç»Ÿ

### 4.3 æ•°æ®åº“è®¾è®¡

ç³»ç»Ÿé‡‡ç”¨PostgreSQLä½œä¸ºä¸»æ•°æ®åº“ï¼ŒåŒ…å«16ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨ï¼š

#### æ ¸å¿ƒä¸šåŠ¡è¡¨ç»“æ„

```mermaid
erDiagram
    users ||--o{ orders : "åˆ›å»º"
    users ||--o{ agent_applications : "ç”³è¯·"
    users ||--o{ agent_earnings : "æ”¶ç›Š"
    users ||--o{ bot_users : "ä½¿ç”¨"
    
    orders ||--o{ energy_transactions : "æ‰§è¡Œ"
    orders }o--|| energy_packages : "é€‰æ‹©"
    orders }o--|| bots : "é€šè¿‡"
    
    energy_pools ||--o{ energy_transactions : "æä¾›"
    
    agents ||--o{ agent_applications : "å¤„ç†"
    agents ||--o{ agent_earnings : "åˆ†é…"
    
    bots ||--o{ bot_users : "ç®¡ç†"
    
    price_configs ||--o{ price_history : "å†å²"
    price_templates ||--o{ price_configs : "æ¨¡æ¿"
    
    system_configs ||--o{ system_config_history : "å†å²"
    
    users {
        uuid id PK
        bigint telegram_id UK
        varchar username
        varchar email UK
        varchar phone
        varchar role
        varchar status
        varchar tron_address
        numeric balance
        integer total_orders
        numeric total_spent
        bigint total_energy_used
        varchar referral_code UK
        uuid referred_by FK
        timestamp created_at
        timestamp updated_at
        varchar password_hash
        varchar login_type
        timestamp last_login_at
        varchar password_reset_token
        timestamp password_reset_expires
        numeric usdt_balance
        numeric trx_balance
    }
    
    orders {
        uuid id PK
        uuid user_id FK
        uuid bot_id FK
        uuid package_id FK
        varchar order_number UK
        varchar order_type
        varchar currency
        varchar payment_status
        varchar status
        bigint energy_amount
        integer duration_hours
        numeric price
        numeric original_price
        numeric discount_amount
        numeric final_price
        varchar payment_method
        varchar transaction_id
        varchar tron_tx_hash
        varchar delegate_tx_hash
        varchar target_address
        timestamp expires_at
        timestamp completed_at
        timestamp created_at
        timestamp updated_at
    }
    
    energy_pools {
        uuid id PK
        varchar name
        varchar tron_address UK
        text private_key_encrypted
        bigint total_energy
        bigint available_energy
        bigint delegated_energy
        numeric trx_balance
        varchar status
        integer priority
        numeric cost_per_energy
        bigint max_delegation_amount
        bigint min_delegation_amount
        bigint daily_limit
        bigint used_today
        timestamp last_used_at
        timestamp created_at
        timestamp updated_at
    }
    
    bots {
        uuid id PK
        varchar name
        varchar token UK
        varchar username UK
        text description
        varchar status
        varchar webhook_url
        varchar webhook_secret
        jsonb settings
        jsonb commands
        text welcome_message
        text help_message
        text error_message
        boolean maintenance_mode
        integer rate_limit
        integer max_users
        integer current_users
        bigint total_messages
        timestamp last_message_at
        timestamp created_at
        timestamp updated_at
    }
    
    agents {
        uuid id PK
        uuid user_id FK
        varchar agent_code UK
        varchar name
        varchar status
        varchar level
        numeric commission_rate
        integer max_subordinates
        integer current_subordinates
        numeric total_earnings
        numeric pending_earnings
        numeric withdrawn_earnings
        uuid parent_agent_id FK
        jsonb settings
        timestamp created_at
        timestamp updated_at
    }
    
    energy_packages {
        uuid id PK
        varchar name
        text description
        bigint energy_amount
        integer duration_hours
        numeric base_price
        varchar currency
        varchar status
        integer sort_order
        boolean is_popular
        numeric discount_rate
        integer min_quantity
        integer max_quantity
        jsonb features
        timestamp created_at
        timestamp updated_at
    }
    
    energy_transactions {
        uuid id PK
        uuid order_id FK
        uuid pool_id FK
        varchar transaction_type
        varchar from_address
        varchar to_address
        bigint energy_amount
        integer duration_hours
        varchar tx_hash
        bigint block_number
        timestamp block_timestamp
        bigint gas_used
        varchar status
        text error_message
        integer retry_count
        timestamp expires_at
        timestamp created_at
        timestamp updated_at
    }
```

#### æ•°æ®åº“è¡¨è¯´æ˜

| è¡¨å | ç”¨é€” | å…³é”®å­—æ®µ |
|------|------|----------|
| users | ç”¨æˆ·ä¿¡æ¯ç®¡ç† | telegram_id, email, tron_address, balance |
| orders | è®¢å•ç®¡ç† | order_number, status, payment_status, energy_amount |
| energy_pools | èƒ½é‡æ± ç®¡ç† | tron_address, available_energy, status, priority |
| bots | æœºå™¨äººé…ç½® | token, username, status, settings |
| agents | ä»£ç†å•†ç®¡ç† | agent_code, commission_rate, total_earnings |
| agent_applications | ä»£ç†ç”³è¯· | user_id, agent_id, status |
| agent_earnings | ä»£ç†æ”¶ç›Š | agent_id, order_id, commission_amount |
| bot_users | æœºå™¨äººç”¨æˆ· | bot_id, user_id, status |
| energy_packages | èƒ½é‡å¥—é¤ | name, energy_amount, base_price |
| energy_transactions | èƒ½é‡äº¤æ˜“è®°å½• | order_id, pool_id, tx_hash, status |
| price_configs | ä»·æ ¼é…ç½® | config_name, base_price, currency |
| price_history | ä»·æ ¼å†å² | config_id, old_price, new_price |
| price_templates | ä»·æ ¼æ¨¡æ¿ | template_name, pricing_rules |
| system_configs | ç³»ç»Ÿé…ç½® | config_key, config_value, category |
| system_config_history | é…ç½®å†å² | config_id, old_value, new_value |
| schema_migrations | æ•°æ®åº“è¿ç§» | version, description, executed_at |

## 5. å¼€å‘ä¼˜å…ˆçº§å’Œæ—¶é—´è§„åˆ’

### 5.1 å¼€å‘ä¼˜å…ˆçº§

**âœ… P0 (æœ€é«˜ä¼˜å…ˆçº§) - å·²å®Œæˆ**:
- âœ… Telegramæœºå™¨äººåŸºç¡€æ¡†æ¶å’Œæ ¸å¿ƒå‘½ä»¤
- âœ… ç”¨æˆ·æ³¨å†Œå’Œè®¤è¯ç³»ç»Ÿ
- âœ… åŸºç¡€è®¢å•æµç¨‹

**âœ… P0 (æœ€é«˜ä¼˜å…ˆçº§) - å·²å®Œæˆ**:
- âœ… TRONåŒºå—é“¾åŸºç¡€é›†æˆ
- âœ… é’±åŒ…ç®¡ç†å’Œèƒ½é‡å§”æ‰˜
- âœ… æ”¯ä»˜ç›‘æ§å’Œç¡®è®¤

**âœ… P1 (é«˜ä¼˜å…ˆçº§) - å·²å®Œæˆ**:
- âœ… èƒ½é‡æ± ç®¡ç†ç³»ç»Ÿ
- âœ… è‡ªåŠ¨åŒ–è°ƒåº¦ç®—æ³•
- âœ… å®Œæ•´ä¸šåŠ¡æµç¨‹æ‰“é€š

**ğŸ”„ P1 (é«˜ä¼˜å…ˆçº§) - è¿›è¡Œä¸­**:
- ğŸ”„ é£é™©æ§åˆ¶å’Œå¼‚å¸¸å¤„ç†
- ğŸ”„ æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§
- ğŸ”„ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 5.2 é‡Œç¨‹ç¢‘ç›®æ ‡

- **âœ… ç¬¬2å‘¨**: æœºå™¨äººå¯ç”¨ï¼Œç”¨æˆ·èƒ½å¤Ÿä¸‹å•
- **âœ… ç¬¬4å‘¨**: TRONé›†æˆå®Œæˆï¼Œèƒ½å¤Ÿæ‰§è¡Œå§”æ‰˜
- **âœ… ç¬¬6å‘¨**: å®Œæ•´ä¸šåŠ¡æµç¨‹æ‰“é€šï¼Œç³»ç»ŸåŸºæœ¬å¯ç”¨
- **ğŸ”„ ç¬¬8å‘¨**: ç³»ç»Ÿè‡ªåŠ¨åŒ–è¿è¥ï¼Œå¯ä»¥å°è§„æ¨¡ä¸Šçº¿

## 6. é£é™©è¯„ä¼°å’Œåº”å¯¹ç­–ç•¥

### 6.1 æŠ€æœ¯é£é™©

**TRONç½‘ç»œç¨³å®šæ€§é£é™©**:
- é£é™©: Shastaæµ‹è¯•ç½‘å¯èƒ½ä¸ç¨³å®š
- åº”å¯¹: å®ç°é‡è¯•æœºåˆ¶ï¼Œå‡†å¤‡ä¸»ç½‘åˆ‡æ¢æ–¹æ¡ˆ

**TronWeb APIé™åˆ¶é£é™©**:
- é£é™©: APIè°ƒç”¨é¢‘ç‡é™åˆ¶
- åº”å¯¹: å®ç°è¯·æ±‚é˜Ÿåˆ—ï¼Œä½¿ç”¨å¤šä¸ªAPIç«¯ç‚¹

### 6.2 ä¸šåŠ¡é£é™©

**èµ„é‡‘å®‰å…¨é£é™©**:
- é£é™©: æ”¯ä»˜å¤„ç†é”™è¯¯å¯¼è‡´èµ„é‡‘æŸå¤±
- åº”å¯¹: å¤šé‡ç¡®è®¤æœºåˆ¶ï¼Œå®Œå–„çš„æ—¥å¿—å’Œç›‘æ§

**ç”¨æˆ·ä½“éªŒé£é™©**:
- é£é™©: æœºå™¨äººå“åº”æ…¢æˆ–åŠŸèƒ½ä¸å®Œæ•´
- åº”å¯¹: æ€§èƒ½ä¼˜åŒ–ï¼Œåˆ†é˜¶æ®µå‘å¸ƒåŠŸèƒ½

## 7. æˆåŠŸæ ‡å‡†

### 7.1 åŠŸèƒ½å®Œæ•´æ€§
- âœ… ç”¨æˆ·å¯ä»¥é€šè¿‡Telegramæœºå™¨äººå®Œæˆå®Œæ•´è´­ä¹°æµç¨‹
- âœ… ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨æ‰§è¡Œèƒ½é‡å§”æ‰˜
- âœ… æ”¯ä»˜ç›‘æ§å’Œç¡®è®¤æœºåˆ¶æ­£å¸¸å·¥ä½œ
- âœ… èƒ½é‡æ± ç®¡ç†ç³»ç»Ÿè‡ªåŠ¨åŒ–è¿è¥

### 7.2 æ€§èƒ½æŒ‡æ ‡
- ğŸ”„ æœºå™¨äººå“åº”æ—¶é—´ < 3ç§’
- ğŸ”„ æ”¯ä»˜ç¡®è®¤æ—¶é—´ < 5åˆ†é’Ÿ
- ğŸ”„ èƒ½é‡å§”æ‰˜æ‰§è¡Œæ—¶é—´ < 10åˆ†é’Ÿ
- ğŸ”„ ç³»ç»Ÿå¯ç”¨æ€§ > 99%

### 7.3 å®‰å…¨æ ‡å‡†
- âœ… ç§é’¥å®‰å…¨å­˜å‚¨ï¼ŒAES-256åŠ å¯†
- âœ… æ”¯ä»˜é˜²é‡å¤å¤„ç†
- ğŸ”„ å¼‚å¸¸æƒ…å†µè‡ªåŠ¨å¤„ç†
- âœ… å®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•

### 7.4 å½“å‰é¡¹ç›®çŠ¶æ€
**é¡¹ç›®å·²å®Œæˆæ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼Œç›®å‰å¤„äºæµ‹è¯•å’Œä¼˜åŒ–é˜¶æ®µ**

#### å·²å®Œæˆçš„æ ¸å¿ƒæ¨¡å—ï¼š
1. âœ… **Telegramæœºå™¨äººé›†æˆæ¨¡å—** - å®Œæ•´å®ç°
2. âœ… **TRONåŒºå—é“¾é›†æˆæ¨¡å—** - å®Œæ•´å®ç°  
3. âœ… **èƒ½é‡æ± ç®¡ç†ç³»ç»Ÿ** - å®Œæ•´å®ç°
4. âœ… **æ”¯ä»˜ä¸äº¤æ˜“å¤„ç†æ¨¡å—** - å®Œæ•´å®ç°

#### å½“å‰å·¥ä½œé‡ç‚¹ï¼š
- ğŸ”„ ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–å’Œç¨³å®šæ€§æå‡
- ğŸ”„ æµ‹è¯•è¦†ç›–ç‡å®Œå–„å’Œè´¨é‡ä¿è¯
- ğŸ”„ é”™è¯¯å¤„ç†å’Œå¼‚å¸¸ç›‘æ§æœºåˆ¶ä¼˜åŒ–
- ğŸ“‹ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‡†å¤‡

---

**æ–‡æ¡£ç»´æŠ¤**: å¼€å‘å›¢é˜Ÿ  
**æ›´æ–°é¢‘ç‡**: æ¯å‘¨æ›´æ–°è¿›åº¦  
**è”ç³»æ–¹å¼**: é¡¹ç›®è´Ÿè´£äºº