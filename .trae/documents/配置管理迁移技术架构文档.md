# é…ç½®ç®¡ç†è¿ç§»æŠ€æœ¯æ¶æ„æ–‡æ¡£

## 1. æ¶æ„è®¾è®¡

### 1.1 æ•´ä½“æ¶æ„

```mermaid
graph TD
    A[ç®¡ç†åå°] --> B[é…ç½®ç®¡ç†API]
    B --> C[Telegramæœºå™¨äººç®¡ç†]
    B --> D[TRONç½‘ç»œé…ç½®ç®¡ç†]
    B --> E[èƒ½é‡æ± è´¦æˆ·ç®¡ç†]
    
    C --> F[å¤šæœºå™¨äººå®ä¾‹]
    D --> G[å¤šç½‘ç»œç¯å¢ƒ]
    E --> H[å¤šé’±åŒ…è´¦æˆ·]
    
    F --> I[Telegram Bot API]
    G --> J[TRONä¸»ç½‘/æµ‹è¯•ç½‘]
    H --> K[èƒ½é‡å§”æ‰˜æœåŠ¡]
    
    B --> L[PostgreSQLæ•°æ®åº“]
    B --> M[Redisç¼“å­˜]
    
    subgraph "å‰ç«¯ç®¡ç†å±‚"
        A
    end
    
    subgraph "é…ç½®ç®¡ç†å±‚"
        B
        C
        D
        E
    end
    
    subgraph "æœåŠ¡å®ä¾‹å±‚"
        F
        G
        H
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡å±‚"
        I
        J
        K
    end
    
    subgraph "æ•°æ®å­˜å‚¨å±‚"
        L
        M
    end
```

### 1.2 è¿ç§»ç­–ç•¥

```mermaid
graph LR
    A[ç¯å¢ƒå˜é‡é…ç½®] --> B[æ•°æ®åº“é…ç½®è¡¨]
    C[å•æœºå™¨äººå®ä¾‹] --> D[å¤šæœºå™¨äººç®¡ç†]
    E[å•ç½‘ç»œé…ç½®] --> F[å¤šç½‘ç»œç¯å¢ƒ]
    G[ç¡¬ç¼–ç é’±åŒ…] --> H[åŠ¨æ€èƒ½é‡æ± ]
    
    subgraph "è¿ç§»å‰"
        A
        C
        E
        G
    end
    
    subgraph "è¿ç§»å"
        B
        D
        F
        H
    end
```

## 2. æŠ€æœ¯æè¿°

* **å‰ç«¯**: Vue.js\@3 + Element Plus + TypeScript + Vite

* **åç«¯**: Node.js\@18 + Express.js\@4 + TypeScript

* **æ•°æ®åº“**: PostgreSQL\@14 (ç°æœ‰æ•°æ®åº“æ‰©å±•)

* **ç¼“å­˜**: Redis\@7 (é…ç½®ç¼“å­˜å’Œä¼šè¯ç®¡ç†)

* **åŒºå—é“¾**: TronWeb\@5.3.0 + å¤šç½‘ç»œæ”¯æŒ

* **æœºå™¨äºº**: node-telegram-bot-api + å¤šå®ä¾‹ç®¡ç†

* **å®‰å…¨**: é…ç½®åŠ å¯†å­˜å‚¨ + æƒé™æ§åˆ¶

## 3. æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡

### 3.1 ç³»ç»Ÿé…ç½®è¡¨ (system\_configs)

```sql
-- ç³»ç»Ÿé…ç½®è¡¨ï¼ˆå·²å­˜åœ¨ï¼Œéœ€æ‰©å±•ï¼‰
CREATE TABLE IF NOT EXISTS system_configs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    config_key VARCHAR(100) NOT NULL UNIQUE,
    config_value JSONB NOT NULL,
    config_type VARCHAR(50) NOT NULL, -- 'telegram', 'tron', 'system'
    description TEXT,
    is_active BOOLEAN DEFAULT true,
    is_encrypted BOOLEAN DEFAULT false,
    created_by UUID REFERENCES admins(id),
    updated_by UUID REFERENCES admins(id),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_system_configs_type ON system_configs(config_type);
CREATE INDEX IF NOT EXISTS idx_system_configs_active ON system_configs(is_active);
```

### 3.2 Telegramæœºå™¨äººé…ç½®è¡¨ (telegram\_bots)

```sql
-- Telegramæœºå™¨äººè¡¨ï¼ˆå·²å­˜åœ¨ï¼Œéœ€æ‰©å±•å­—æ®µï¼‰
ALTER TABLE telegram_bots ADD COLUMN IF NOT EXISTS network_config JSONB;
ALTER TABLE telegram_bots ADD COLUMN IF NOT EXISTS webhook_config JSONB;
ALTER TABLE telegram_bots ADD COLUMN IF NOT EXISTS message_templates JSONB;
ALTER TABLE telegram_bots ADD COLUMN IF NOT EXISTS rate_limits JSONB;
ALTER TABLE telegram_bots ADD COLUMN IF NOT EXISTS security_settings JSONB;
ALTER TABLE telegram_bots ADD COLUMN IF NOT EXISTS last_health_check TIMESTAMP WITH TIME ZONE;
ALTER TABLE telegram_bots ADD COLUMN IF NOT EXISTS health_status VARCHAR(20) DEFAULT 'unknown';

-- æ·»åŠ æ³¨é‡Š
COMMENT ON COLUMN telegram_bots.network_config IS 'Telegramç½‘ç»œé…ç½®ï¼ˆAPIç«¯ç‚¹ã€è¶…æ—¶ç­‰ï¼‰';
COMMENT ON COLUMN telegram_bots.webhook_config IS 'Webhooké…ç½®ï¼ˆURLã€å¯†é’¥ã€å…è®¸çš„æ›´æ–°ç±»å‹ï¼‰';
COMMENT ON COLUMN telegram_bots.message_templates IS 'æ¶ˆæ¯æ¨¡æ¿é…ç½®';
COMMENT ON COLUMN telegram_bots.rate_limits IS 'é¢‘ç‡é™åˆ¶é…ç½®';
COMMENT ON COLUMN telegram_bots.security_settings IS 'å®‰å…¨è®¾ç½®ï¼ˆIPç™½åå•ã€åŠ å¯†ç­‰ï¼‰';
```

### 3.3 TRONç½‘ç»œé…ç½®è¡¨ (tron\_networks)

```sql
-- TRONç½‘ç»œé…ç½®è¡¨ï¼ˆæ–°å»ºï¼‰
CREATE TABLE tron_networks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    network_name VARCHAR(50) NOT NULL UNIQUE, -- 'mainnet', 'shasta', 'nile'
    display_name VARCHAR(100) NOT NULL,
    full_host VARCHAR(255) NOT NULL,
    solidity_node VARCHAR(255),
    event_server VARCHAR(255),
    api_key TEXT, -- åŠ å¯†å­˜å‚¨
    chain_id INTEGER,
    block_time INTEGER DEFAULT 3000, -- å‡ºå—æ—¶é—´(ms)
    energy_price BIGINT, -- èƒ½é‡ä»·æ ¼(sun)
    bandwidth_price BIGINT, -- å¸¦å®½ä»·æ ¼(sun)
    contracts JSONB, -- åˆçº¦åœ°å€é…ç½®
    is_testnet BOOLEAN DEFAULT false,
    is_active BOOLEAN DEFAULT true,
    priority INTEGER DEFAULT 0, -- ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_tron_networks_active ON tron_networks(is_active);
CREATE INDEX idx_tron_networks_priority ON tron_networks(priority DESC);

-- åˆå§‹åŒ–æ•°æ®
INSERT INTO tron_networks (network_name, display_name, full_host, chain_id, is_testnet, contracts, priority) VALUES
('mainnet', 'TRONä¸»ç½‘', 'https://api.trongrid.io', 1, false, 
 '{
   "USDT": "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t",
   "USDC": "TEkxiTehnzSmSe2XqrBj4w32RUN966rdz8"
 }', 100),
('shasta', 'Shastaæµ‹è¯•ç½‘', 'https://api.shasta.trongrid.io', 2, true,
 '{
   "USDT": "TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs",
   "TEST_TOKEN": "TXYZpUAh2cGS4k9fycKJitaK4Fc4BKBwif"
 }', 90),
('nile', 'Nileæµ‹è¯•ç½‘', 'https://nile.trongrid.io', 3, true,
 '{
   "USDT": "TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj"
 }', 80);
```

### 3.4 èƒ½é‡æ± è´¦æˆ·è¡¨ (energy\_pools)

```sql
-- èƒ½é‡æ± è¡¨ï¼ˆå·²å­˜åœ¨ï¼Œéœ€æ‰©å±•å­—æ®µï¼‰
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS network_id UUID REFERENCES tron_networks(id);
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS account_name VARCHAR(100);
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS account_type public.account_type DEFAULT 'own_energy';
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS frozen_balance BIGINT DEFAULT 0;
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS energy_limit BIGINT DEFAULT 0;
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS bandwidth_limit BIGINT DEFAULT 0;
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS last_sync_at TIMESTAMP WITH TIME ZONE;
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS sync_status VARCHAR(20) DEFAULT 'pending';
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS auto_refill BOOLEAN DEFAULT false;
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS min_energy_threshold BIGINT DEFAULT 100000;
ALTER TABLE energy_pools ADD COLUMN IF NOT EXISTS priority INTEGER DEFAULT 0;

-- æ·»åŠ æ³¨é‡Š
COMMENT ON COLUMN energy_pools.network_id IS 'å…³è”çš„TRONç½‘ç»œID';
COMMENT ON COLUMN energy_pools.account_name IS 'è´¦æˆ·åˆ«å';
COMMENT ON COLUMN energy_pools.account_type IS 'è´¦æˆ·ç±»å‹ï¼šown_energy, agent_energy, third_party';
COMMENT ON COLUMN energy_pools.auto_refill IS 'æ˜¯å¦è‡ªåŠ¨è¡¥å……èƒ½é‡';
COMMENT ON COLUMN energy_pools.min_energy_threshold IS 'æœ€å°èƒ½é‡é˜ˆå€¼';
```

### 3.5 æœºå™¨äººç½‘ç»œå…³è”è¡¨ (bot\_network\_configs)

```sql
-- æœºå™¨äººç½‘ç»œé…ç½®å…³è”è¡¨ï¼ˆæ–°å»ºï¼‰
CREATE TABLE bot_network_configs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    bot_id UUID NOT NULL REFERENCES telegram_bots(id) ON DELETE CASCADE,
    network_id UUID NOT NULL REFERENCES tron_networks(id) ON DELETE CASCADE,
    is_primary BOOLEAN DEFAULT false, -- æ˜¯å¦ä¸ºä¸»è¦ç½‘ç»œ
    energy_pool_ids UUID[], -- å…³è”çš„èƒ½é‡æ± IDæ•°ç»„
    pricing_config JSONB, -- è¯¥ç½‘ç»œä¸‹çš„å®šä»·é…ç½®
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(bot_id, network_id)
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_bot_network_configs_bot ON bot_network_configs(bot_id);
CREATE INDEX idx_bot_network_configs_network ON bot_network_configs(network_id);
CREATE INDEX idx_bot_network_configs_primary ON bot_network_configs(bot_id, is_primary) WHERE is_primary = true;
```

### 3.6 é…ç½®å˜æ›´å†å²è¡¨ (system\_config\_history)

```sql
-- ç³»ç»Ÿé…ç½®å˜æ›´å†å²è¡¨ï¼ˆæ–°å»ºï¼‰
CREATE TABLE system_config_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    config_id UUID REFERENCES system_configs(id),
    table_name VARCHAR(50) NOT NULL, -- 'telegram_bots', 'tron_networks', 'energy_pools'
    record_id UUID NOT NULL,
    action_type VARCHAR(20) NOT NULL, -- 'create', 'update', 'delete', 'activate', 'deactivate'
    old_values JSONB,
    new_values JSONB,
    changed_fields TEXT[],
    change_reason TEXT,
    changed_by UUID REFERENCES admins(id),
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_config_history_table_record ON system_config_history(table_name, record_id);
CREATE INDEX idx_config_history_changed_by ON system_config_history(changed_by);
CREATE INDEX idx_config_history_created_at ON system_config_history(created_at DESC);
```

## 4. APIæ¥å£è®¾è®¡

### 4.1 Telegramæœºå™¨äººç®¡ç†API

#### è·å–æœºå™¨äººåˆ—è¡¨

```
GET /api/admin/bots
```

Query Parameters:

| å‚æ•°å     | ç±»å‹     | å¿…éœ€    | æè¿°                         |
| ------- | ------ | ----- | -------------------------- |
| page    | number | false | é¡µç ï¼Œé»˜è®¤1                     |
| limit   | number | false | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20                  |
| status  | string | false | çŠ¶æ€ç­›é€‰ï¼šactive, inactive, all |
| network | string | false | ç½‘ç»œç­›é€‰ï¼šmainnet, shasta, nile |

Response:

```json
{
  "success": true,
  "data": {
    "bots": [
      {
        "id": "uuid",
        "bot_name": "ä¸»åŠ›æœºå™¨äºº",
        "bot_username": "energy_rental_bot",
        "is_active": true,
        "health_status": "healthy",
        "last_activity_at": "2024-01-15T10:30:00Z",
        "networks": [
          {
            "network_name": "shasta",
            "display_name": "Shastaæµ‹è¯•ç½‘",
            "is_primary": true,
            "energy_pools_count": 3
          }
        ],
        "stats": {
          "total_users": 1250,
          "active_users_24h": 89,
          "orders_today": 45
        }
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 5,
      "total_count": 12,
      "per_page": 20
    }
  }
}
```

#### åˆ›å»ºæœºå™¨äºº

```
POST /api/admin/bots
```

Request:

```json
{
  "bot_name": "æ–°æœºå™¨äºº",
  "bot_token": "1234567890:ABCDEF...",
  "description": "ç”¨äºæµ‹è¯•çš„æœºå™¨äºº",
  "webhook_config": {
    "url": "https://yourdomain.com/webhook/telegram",
    "secret_token": "your-secret-token",
    "allowed_updates": ["message", "callback_query"]
  },
  "network_configs": [
    {
      "network_id": "uuid",
      "is_primary": true,
      "energy_pool_ids": ["uuid1", "uuid2"]
    }
  ],
  "rate_limits": {
    "messages_per_minute": 30,
    "commands_per_hour": 100
  }
}
```

#### æ›´æ–°æœºå™¨äººé…ç½®

```
PUT /api/admin/bots/:id
```

#### åˆ‡æ¢æœºå™¨äººçŠ¶æ€

```
PUT /api/admin/bots/:id/status
```

Request:

```json
{
  "is_active": true,
  "reason": "æ¢å¤æœåŠ¡"
}
```

#### è·å–æœºå™¨äººå¥åº·çŠ¶æ€

```
GET /api/admin/bots/:id/health
```

#### æµ‹è¯•æœºå™¨äººè¿æ¥

```
POST /api/admin/bots/:id/test
```

### 4.2 TRONç½‘ç»œé…ç½®API

#### è·å–ç½‘ç»œåˆ—è¡¨

```
GET /api/admin/tron/networks
```

Response:

```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "network_name": "mainnet",
      "display_name": "TRONä¸»ç½‘",
      "full_host": "https://api.trongrid.io",
      "is_testnet": false,
      "is_active": true,
      "energy_price": 420,
      "contracts": {
        "USDT": "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t"
      },
      "stats": {
        "connected_bots": 5,
        "energy_pools": 12,
        "daily_transactions": 234
      }
    }
  ]
}
```

#### åˆ›å»ºç½‘ç»œé…ç½®

```
POST /api/admin/tron/networks
```

Request:

```json
{
  "network_name": "custom_testnet",
  "display_name": "è‡ªå®šä¹‰æµ‹è¯•ç½‘",
  "full_host": "https://custom.trongrid.io",
  "api_key": "your-api-key",
  "is_testnet": true,
  "contracts": {
    "USDT": "contract-address"
  }
}
```

#### æ›´æ–°ç½‘ç»œé…ç½®

```
PUT /api/admin/tron/networks/:id
```

#### æµ‹è¯•ç½‘ç»œè¿æ¥

```
POST /api/admin/tron/networks/:id/test
```

### 4.3 èƒ½é‡æ± ç®¡ç†API

#### è·å–èƒ½é‡æ± åˆ—è¡¨

```
GET /api/admin/energy-pools
```

Query Parameters:

| å‚æ•°å           | ç±»å‹     | å¿…éœ€    | æè¿°     |
| ------------- | ------ | ----- | ------ |
| network\_id   | string | false | ç½‘ç»œIDç­›é€‰ |
| account\_type | string | false | è´¦æˆ·ç±»å‹ç­›é€‰ |
| status        | string | false | çŠ¶æ€ç­›é€‰   |

Response:

```json
{
  "success": true,
  "data": {
    "pools": [
      {
        "id": "uuid",
        "account_name": "ä¸»åŠ›èƒ½é‡æ± 1",
        "address": "TRX_ADDRESS",
        "account_type": "own_energy",
        "network": {
          "id": "uuid",
          "network_name": "shasta",
          "display_name": "Shastaæµ‹è¯•ç½‘"
        },
        "balance": {
          "trx": "1000.5",
          "energy": 500000,
          "bandwidth": 5000
        },
        "is_active": true,
        "last_sync_at": "2024-01-15T10:30:00Z",
        "stats": {
          "delegations_today": 25,
          "energy_used_today": 150000
        }
      }
    ]
  }
}
```

#### åˆ›å»ºèƒ½é‡æ± è´¦æˆ·

```
POST /api/admin/energy-pools
```

Request:

```json
{
  "account_name": "æ–°èƒ½é‡æ± ",
  "network_id": "uuid",
  "account_type": "own_energy",
  "private_key": "private-key-here", // å°†è¢«åŠ å¯†å­˜å‚¨
  "auto_refill": true,
  "min_energy_threshold": 100000
}
```

#### å¯¼å…¥ç°æœ‰è´¦æˆ·

```
POST /api/admin/energy-pools/import
```

Request:

```json
{
  "account_name": "å¯¼å…¥çš„è´¦æˆ·",
  "address": "TRX_ADDRESS",
  "private_key": "private-key",
  "network_id": "uuid"
}
```

#### åŒæ­¥è´¦æˆ·ä½™é¢

```
POST /api/admin/energy-pools/:id/sync
```

#### æ‰¹é‡æ“ä½œ

```
POST /api/admin/energy-pools/batch
```

Request:

```json
{
  "action": "activate", // activate, deactivate, sync
  "pool_ids": ["uuid1", "uuid2"],
  "reason": "æ‰¹é‡æ¿€æ´»"
}
```

### 4.4 é…ç½®å…³è”API

#### è·å–æœºå™¨äººç½‘ç»œé…ç½®

```
GET /api/admin/bots/:id/networks
```

#### æ›´æ–°æœºå™¨äººç½‘ç»œé…ç½®

```
PUT /api/admin/bots/:id/networks
```

Request:

```json
{
  "network_configs": [
    {
      "network_id": "uuid",
      "is_primary": true,
      "energy_pool_ids": ["uuid1", "uuid2"],
      "pricing_config": {
        "energy_flash_rent": {
          "32000": {"price": 1.5, "currency": "TRX"}
        }
      }
    }
  ]
}
```

#### è·å–ç½‘ç»œä¸‹çš„èƒ½é‡æ± 

```
GET /api/admin/tron/networks/:id/energy-pools
```

## 5. å‰ç«¯ç®¡ç†ç•Œé¢è®¾è®¡

### 5.1 é¡µé¢è·¯ç”±æ‰©å±•

```typescript
// åœ¨ç°æœ‰è·¯ç”±åŸºç¡€ä¸Šæ‰©å±•
const routes = [
  // ç°æœ‰è·¯ç”±...
  {
    path: '/bots',
    name: 'BotManagement',
    component: () => import('@/views/BotManagement/index.vue'),
    children: [
      {
        path: '',
        name: 'BotList',
        component: () => import('@/views/BotManagement/BotList.vue')
      },
      {
        path: 'create',
        name: 'BotCreate',
        component: () => import('@/views/BotManagement/BotForm.vue')
      },
      {
        path: ':id/edit',
        name: 'BotEdit',
        component: () => import('@/views/BotManagement/BotForm.vue')
      },
      {
        path: ':id/networks',
        name: 'BotNetworks',
        component: () => import('@/views/BotManagement/BotNetworks.vue')
      }
    ]
  },
  {
    path: '/tron-networks',
    name: 'TronNetworks',
    component: () => import('@/views/TronNetworks/index.vue')
  },
  {
    path: '/energy-pools',
    name: 'EnergyPools',
    component: () => import('@/views/EnergyPools/index.vue')
  }
];
```

### 5.2 æœºå™¨äººç®¡ç†ç•Œé¢

#### æœºå™¨äººåˆ—è¡¨é¡µé¢

```vue
<!-- BotList.vue -->
<template>
  <div class="bot-management">
    <!-- é¡¶éƒ¨æ“ä½œæ  -->
    <div class="toolbar">
      <el-button type="primary" @click="createBot">
        <el-icon><Plus /></el-icon>
        æ·»åŠ æœºå™¨äºº
      </el-button>
      <el-button @click="batchOperation">
        <el-icon><Operation /></el-icon>
        æ‰¹é‡æ“ä½œ
      </el-button>
      <div class="filters">
        <el-select v-model="filters.status" placeholder="çŠ¶æ€ç­›é€‰">
          <el-option label="å…¨éƒ¨" value="all" />
          <el-option label="æ´»è·ƒ" value="active" />
          <el-option label="åœç”¨" value="inactive" />
        </el-select>
        <el-select v-model="filters.network" placeholder="ç½‘ç»œç­›é€‰">
          <el-option label="å…¨éƒ¨ç½‘ç»œ" value="all" />
          <el-option label="ä¸»ç½‘" value="mainnet" />
          <el-option label="Shastaæµ‹è¯•ç½‘" value="shasta" />
        </el-select>
      </div>
    </div>

    <!-- æœºå™¨äººå¡ç‰‡åˆ—è¡¨ -->
    <div class="bot-grid">
      <el-card 
        v-for="bot in bots" 
        :key="bot.id" 
        class="bot-card"
        :class="{ 'inactive': !bot.is_active }"
      >
        <template #header>
          <div class="card-header">
            <div class="bot-info">
              <h3>{{ bot.bot_name }}</h3>
              <span class="username">@{{ bot.bot_username }}</span>
            </div>
            <div class="status-indicator">
              <el-tag 
                :type="getStatusType(bot.health_status)"
                size="small"
              >
                {{ getStatusText(bot.health_status) }}
              </el-tag>
            </div>
          </div>
        </template>

        <div class="bot-content">
          <!-- ç½‘ç»œé…ç½® -->
          <div class="networks">
            <h4>å…³è”ç½‘ç»œ</h4>
            <div class="network-tags">
              <el-tag 
                v-for="network in bot.networks" 
                :key="network.network_name"
                :type="network.is_primary ? 'primary' : 'info'"
                size="small"
              >
                {{ network.display_name }}
                <span v-if="network.is_primary">ï¼ˆä¸»ï¼‰</span>
              </el-tag>
            </div>
          </div>

          <!-- ç»Ÿè®¡ä¿¡æ¯ -->
          <div class="stats">
            <div class="stat-item">
              <span class="label">æ€»ç”¨æˆ·æ•°</span>
              <span class="value">{{ bot.stats.total_users }}</span>
            </div>
            <div class="stat-item">
              <span class="label">24hæ´»è·ƒ</span>
              <span class="value">{{ bot.stats.active_users_24h }}</span>
            </div>
            <div class="stat-item">
              <span class="label">ä»Šæ—¥è®¢å•</span>
              <span class="value">{{ bot.stats.orders_today }}</span>
            </div>
          </div>

          <!-- æœ€åæ´»åŠ¨æ—¶é—´ -->
          <div class="last-activity">
            <el-icon><Clock /></el-icon>
            æœ€åæ´»åŠ¨: {{ formatTime(bot.last_activity_at) }}
          </div>
        </div>

        <template #footer>
          <div class="card-actions">
            <el-button size="small" @click="editBot(bot.id)">
              ç¼–è¾‘
            </el-button>
            <el-button size="small" @click="configNetworks(bot.id)">
              ç½‘ç»œé…ç½®
            </el-button>
            <el-button 
              size="small" 
              @click="testBot(bot.id)"
              :loading="testing[bot.id]"
            >
              æµ‹è¯•è¿æ¥
            </el-button>
            <el-button 
              size="small" 
              :type="bot.is_active ? 'danger' : 'success'"
              @click="toggleStatus(bot)"
            >
              {{ bot.is_active ? 'åœç”¨' : 'å¯ç”¨' }}
            </el-button>
          </div>
        </template>
      </el-card>
    </div>

    <!-- åˆ†é¡µ -->
    <el-pagination
      v-model:current-page="pagination.current_page"
      v-model:page-size="pagination.per_page"
      :total="pagination.total_count"
      layout="total, sizes, prev, pager, next, jumper"
      @size-change="handleSizeChange"
      @current-change="handleCurrentChange"
    />
  </div>
</template>
```

#### æœºå™¨äººè¡¨å•é¡µé¢

```vue
<!-- BotForm.vue -->
<template>
  <div class="bot-form">
    <el-form 
      ref="formRef" 
      :model="form" 
      :rules="rules" 
      label-width="120px"
    >
      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <el-card title="åŸºæœ¬ä¿¡æ¯">
        <el-form-item label="æœºå™¨äººåç§°" prop="bot_name">
          <el-input v-model="form.bot_name" placeholder="è¯·è¾“å…¥æœºå™¨äººåç§°" />
        </el-form-item>
        
        <el-form-item label="Bot Token" prop="bot_token">
          <el-input 
            v-model="form.bot_token" 
            type="password" 
            show-password
            placeholder="è¯·è¾“å…¥Telegram Bot Token"
          />
          <div class="form-tip">
            ä» @BotFather è·å–çš„æœºå™¨äººToken
          </div>
        </el-form-item>
        
        <el-form-item label="æè¿°" prop="description">
          <el-input 
            v-model="form.description" 
            type="textarea" 
            :rows="3"
            placeholder="è¯·è¾“å…¥æœºå™¨äººæè¿°"
          />
        </el-form-item>
      </el-card>

      <!-- Webhooké…ç½® -->
      <el-card title="Webhooké…ç½®">
        <el-form-item label="Webhook URL" prop="webhook_config.url">
          <el-input 
            v-model="form.webhook_config.url" 
            placeholder="https://yourdomain.com/webhook/telegram"
          />
        </el-form-item>
        
        <el-form-item label="å¯†é’¥Token" prop="webhook_config.secret_token">
          <el-input 
            v-model="form.webhook_config.secret_token" 
            type="password" 
            show-password
            placeholder="WebhookéªŒè¯å¯†é’¥"
          />
        </el-form-item>
        
        <el-form-item label="å…è®¸çš„æ›´æ–°ç±»å‹">
          <el-checkbox-group v-model="form.webhook_config.allowed_updates">
            <el-checkbox label="message">æ¶ˆæ¯</el-checkbox>
            <el-checkbox label="callback_query">å›è°ƒæŸ¥è¯¢</el-checkbox>
            <el-checkbox label="inline_query">å†…è”æŸ¥è¯¢</el-checkbox>
          </el-checkbox-group>
        </el-form-item>
      </el-card>

      <!-- ç½‘ç»œé…ç½® -->
      <el-card title="ç½‘ç»œé…ç½®">
        <div class="network-configs">
          <div 
            v-for="(config, index) in form.network_configs" 
            :key="index"
            class="network-config-item"
          >
            <el-form-item :label="`ç½‘ç»œ ${index + 1}`">
              <el-select 
                v-model="config.network_id" 
                placeholder="é€‰æ‹©TRONç½‘ç»œ"
                style="width: 200px;"
              >
                <el-option 
                  v-for="network in availableNetworks" 
                  :key="network.id"
                  :label="network.display_name"
                  :value="network.id"
                />
              </el-select>
              
              <el-checkbox 
                v-model="config.is_primary" 
                style="margin-left: 10px;"
              >
                ä¸»è¦ç½‘ç»œ
              </el-checkbox>
              
              <el-button 
                type="danger" 
                size="small" 
                @click="removeNetworkConfig(index)"
                style="margin-left: 10px;"
              >
                åˆ é™¤
              </el-button>
            </el-form-item>
            
            <el-form-item label="å…³è”èƒ½é‡æ± ">
              <el-select 
                v-model="config.energy_pool_ids" 
                multiple 
                placeholder="é€‰æ‹©èƒ½é‡æ± è´¦æˆ·"
                style="width: 100%;"
              >
                <el-option 
                  v-for="pool in getNetworkPools(config.network_id)" 
                  :key="pool.id"
                  :label="`${pool.account_name} (${pool.address})`"
                  :value="pool.id"
                />
              </el-select>
            </el-form-item>
          </div>
          
          <el-button @click="addNetworkConfig" type="dashed">
            <el-icon><Plus /></el-icon>
            æ·»åŠ ç½‘ç»œé…ç½®
          </el-button>
        </div>
      </el-card>

      <!-- å®‰å…¨è®¾ç½® -->
      <el-card title="å®‰å…¨è®¾ç½®">
        <el-form-item label="é¢‘ç‡é™åˆ¶">
          <el-row :gutter="20">
            <el-col :span="12">
              <el-input 
                v-model.number="form.rate_limits.messages_per_minute" 
                type="number"
                placeholder="æ¯åˆ†é’Ÿæ¶ˆæ¯æ•°"
              >
                <template #append>æ¡/åˆ†é’Ÿ</template>
              </el-input>
            </el-col>
            <el-col :span="12">
              <el-input 
                v-model.number="form.rate_limits.commands_per_hour" 
                type="number"
                placeholder="æ¯å°æ—¶å‘½ä»¤æ•°"
              >
                <template #append>æ¡/å°æ—¶</template>
              </el-input>
            </el-col>
          </el-row>
        </el-form-item>
      </el-card>

      <!-- æäº¤æŒ‰é’® -->
      <div class="form-actions">
        <el-button @click="$router.back()">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="submitForm" :loading="submitting">
          {{ isEdit ? 'æ›´æ–°' : 'åˆ›å»º' }}æœºå™¨äºº
        </el-button>
      </div>
    </el-form>
  </div>
</template>
```

### 5.3 TRONç½‘ç»œç®¡ç†ç•Œé¢

```vue
<!-- TronNetworks/index.vue -->
<template>
  <div class="tron-networks">
    <div class="page-header">
      <h2>TRONç½‘ç»œé…ç½®</h2>
      <el-button type="primary" @click="createNetwork">
        <el-icon><Plus /></el-icon>
        æ·»åŠ ç½‘ç»œ
      </el-button>
    </div>

    <div class="network-list">
      <el-card 
        v-for="network in networks" 
        :key="network.id" 
        class="network-card"
      >
        <template #header>
          <div class="card-header">
            <div class="network-info">
              <h3>{{ network.display_name }}</h3>
              <el-tag 
                :type="network.is_testnet ? 'warning' : 'success'"
                size="small"
              >
                {{ network.is_testnet ? 'æµ‹è¯•ç½‘' : 'ä¸»ç½‘' }}
              </el-tag>
            </div>
            <div class="status">
              <el-switch 
                v-model="network.is_active" 
                @change="toggleNetworkStatus(network)"
              />
            </div>
          </div>
        </template>

        <div class="network-content">
          <div class="network-details">
            <div class="detail-item">
              <span class="label">èŠ‚ç‚¹åœ°å€:</span>
              <span class="value">{{ network.full_host }}</span>
            </div>
            <div class="detail-item">
              <span class="label">é“¾ID:</span>
              <span class="value">{{ network.chain_id }}</span>
            </div>
            <div class="detail-item">
              <span class="label">èƒ½é‡ä»·æ ¼:</span>
              <span class="value">{{ network.energy_price }} sun</span>
            </div>
          </div>

          <div class="contracts">
            <h4>åˆçº¦åœ°å€</h4>
            <div class="contract-list">
              <div 
                v-for="(address, name) in network.contracts" 
                :key="name"
                class="contract-item"
              >
                <span class="contract-name">{{ name }}:</span>
                <span class="contract-address">{{ address }}</span>
                <el-button 
                  size="small" 
                  text 
                  @click="copyToClipboard(address)"
                >
                  å¤åˆ¶
                </el-button>
              </div>
            </div>
          </div>

          <div class="stats">
            <div class="stat-item">
              <span class="label">å…³è”æœºå™¨äºº</span>
              <span class="value">{{ network.stats.connected_bots }}</span>
            </div>
            <div class="stat-item">
              <span class="label">èƒ½é‡æ± æ•°é‡</span>
              <span class="value">{{ network.stats.energy_pools }}</span>
            </div>
            <div class="stat-item">
              <span class="label">æ—¥äº¤æ˜“é‡</span>
              <span class="value">{{ network.stats.daily_transactions }}</span>
            </div>
          </div>
        </div>

        <template #footer>
          <div class="card-actions">
            <el-button size="small" @click="editNetwork(network.id)">
              ç¼–è¾‘
            </el-button>
            <el-button 
              size="small" 
              @click="testConnection(network.id)"
              :loading="testing[network.id]"
            >
              æµ‹è¯•è¿æ¥
            </el-button>
            <el-button size="small" @click="viewPools(network.id)">
              æŸ¥çœ‹èƒ½é‡æ± 
            </el-button>
          </div>
        </template>
      </el-card>
    </div>
  </div>
</template>
```

### 5.4 èƒ½é‡æ± ç®¡ç†ç•Œé¢

```vue
<!-- EnergyPools/index.vue -->
<template>
  <div class="energy-pools">
    <div class="page-header">
      <h2>èƒ½é‡æ± ç®¡ç†</h2>
      <div class="header-actions">
        <el-button @click="syncAllPools" :loading="syncing">
          <el-icon><Refresh /></el-icon>
          åŒæ­¥ä½™é¢
        </el-button>
        <el-button type="primary" @click="createPool">
          <el-icon><Plus /></el-icon>
          æ·»åŠ èƒ½é‡æ± 
        </el-button>
        <el-button @click="importPool">
          <el-icon><Upload /></el-icon>
          å¯¼å…¥è´¦æˆ·
        </el-button>
      </div>
    </div>

    <!-- ç­›é€‰å™¨ -->
    <div class="filters">
      <el-select v-model="filters.network_id" placeholder="é€‰æ‹©ç½‘ç»œ">
        <el-option label="å…¨éƒ¨ç½‘ç»œ" value="" />
        <el-option 
          v-for="network in networks" 
          :key="network.id"
          :label="network.display_name"
          :value="network.id"
        />
      </el-select>
      
      <el-select v-model="filters.account_type" placeholder="è´¦æˆ·ç±»å‹">
        <el-option label="å…¨éƒ¨ç±»å‹" value="" />
        <el-option label="è‡ªæœ‰èƒ½é‡" value="own_energy" />
        <el-option label="ä»£ç†èƒ½é‡" value="agent_energy" />
        <el-option label="ç¬¬ä¸‰æ–¹" value="third_party" />
      </el-select>
      
      <el-select v-model="filters.status" placeholder="çŠ¶æ€">
        <el-option label="å…¨éƒ¨çŠ¶æ€" value="" />
        <el-option label="æ´»è·ƒ" value="active" />
        <el-option label="åœç”¨" value="inactive" />
      </el-select>
    </div>

    <!-- èƒ½é‡æ± è¡¨æ ¼ -->
    <el-table 
      :data="pools" 
      v-loading="loading"
      @selection-change="handleSelectionChange"
    >
      <el-table-column type="selection" width="55" />
      
      <el-table-column label="è´¦æˆ·åç§°" prop="account_name" width="150">
        <template #default="{ row }">
          <div class="account-info">
            <div class="name">{{ row.account_name }}</div>
            <div class="type">
              <el-tag size="small" :type="getAccountTypeColor(row.account_type)">
                {{ getAccountTypeText(row.account_type) }}
              </el-tag>
            </div>
          </div>
        </template>
      </el-table-column>
      
      <el-table-column label="åœ°å€" prop="address" width="200">
        <template #default="{ row }">
          <div class="address-cell">
            <span class="address">{{ formatAddress(row.address) }}</span>
            <el-button 
              size="small" 
              text 
              @click="copyToClipboard(row.address)"
            >
              å¤åˆ¶
            </el-button>
          </div>
        </template>
      </el-table-column>
      
      <el-table-column label="ç½‘ç»œ" width="120">
        <template #default="{ row }">
          <el-tag 
            size="small" 
            :type="row.network.is_testnet ? 'warning' : 'success'"
          >
            {{ row.network.display_name }}
          </el-tag>
        </template>
      </el-table-column>
      
      <el-table-column label="ä½™é¢ä¿¡æ¯" width="200">
        <template #default="{ row }">
          <div class="balance-info">
            <div class="balance-item">
              <span class="label">TRX:</span>
              <span class="value">{{ row.balance.trx }}</span>
            </div>
            <div class="balance-item">
              <span class="label">èƒ½é‡:</span>
              <span class="value">{{ formatNumber(row.balance.energy) }}</span>
            </div>
            <div class="balance-item">
              <span class="label">å¸¦å®½:</span>
              <span class="value">{{ formatNumber(row.balance.bandwidth) }}</span>
            </div>
          </div>
        </template>
      </el-table-column>
      
      <el-table-column label="çŠ¶æ€" width="100">
        <template #default="{ row }">
          <el-tag 
            :type="row.is_active ? 'success' : 'danger'"
            size="small"
          >
            {{ row.is_active ? 'æ´»è·ƒ' : 'åœç”¨' }}
          </el-tag>
        </template>
      </el-table-column>
      
      <el-table-column label="ç»Ÿè®¡" width="150">
        <template #default="{ row }">
          <div class="stats-info">
            <div class="stat-item">
              <span class="label">ä»Šæ—¥å§”æ‰˜:</span>
              <span class="value">{{ row.stats.delegations_today }}</span>
            </div>
            <div class="stat-item">
              <span class="label">èƒ½é‡æ¶ˆè€—:</span>
              <span class="value">{{ formatNumber(row.stats.energy_used_today) }}</span>
            </div>
          </div>
        </template>
      </el-table-column>
      
      <el-table-column label="æœ€ååŒæ­¥" width="150">
        <template #default="{ row }">
          <div class="sync-info">
            <div class="time">{{ formatTime(row.last_sync_at) }}</div>
            <el-tag 
              size="small" 
              :type="getSyncStatusColor(row.sync_status)"
            >
              {{ getSyncStatusText(row.sync_status) }}
            </el-tag>
          </div>
        </template>
      </el-table-column>
      
      <el-table-column label="æ“ä½œ" width="200" fixed="right">
        <template #default="{ row }">
          <div class="actions">
            <el-button size="small" @click="editPool(row.id)">
              ç¼–è¾‘
            </el-button>
            <el-button 
              size="small" 
              @click="syncPool(row.id)"
              :loading="syncing"
            >
              åŒæ­¥
            </el-button>
            <el-button 
              size="small" 
              :type="row.is_active ? 'danger' : 'success'"
              @click="togglePoolStatus(row)"
            >
              {{ row.is_active ? 'åœç”¨' : 'å¯ç”¨' }}
            </el-button>
          </div>
        </template>
      </el-table-column>
    </el-table>

    <!-- æ‰¹é‡æ“ä½œ -->
    <div v-if="selectedPools.length > 0" class="batch-actions">
      <span>å·²é€‰æ‹© {{ selectedPools.length }} ä¸ªè´¦æˆ·</span>
      <el-button @click="batchSync">æ‰¹é‡åŒæ­¥</el-button>
      <el-button @click="batchActivate">æ‰¹é‡å¯ç”¨</el-button>
      <el-button @click="batchDeactivate">æ‰¹é‡åœç”¨</el-button>
    </div>
  </div>
</template>
```

## 6. é…ç½®è¿ç§»å®æ–½æ–¹æ¡ˆ

### 6.1 è¿ç§»æ­¥éª¤

#### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®åº“å‡†å¤‡

1. åˆ›å»ºæ–°çš„é…ç½®è¡¨ç»“æ„
2. æ•°æ®è¿ç§»è„šæœ¬å¼€å‘
3. ä»ç¯å¢ƒå˜é‡å¯¼å…¥ç°æœ‰é…ç½®

#### ç¬¬äºŒé˜¶æ®µï¼šåç«¯APIå¼€å‘

1. é…ç½®ç®¡ç†APIå¼€å‘
2. é…ç½®ç¼“å­˜æœºåˆ¶å®ç°
3. é…ç½®å˜æ›´é€šçŸ¥ç³»ç»Ÿ

#### ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯ç•Œé¢å¼€å‘

1. ç®¡ç†ç•Œé¢å¼€å‘
2. é…ç½®è¡¨å•å’ŒéªŒè¯
3. å®æ—¶çŠ¶æ€ç›‘æ§

#### ç¬¬å››é˜¶æ®µï¼šæœåŠ¡é‡æ„

1. æœºå™¨äººæœåŠ¡åŠ¨æ€é…ç½®åŠ è½½
2. TRONæœåŠ¡å¤šç½‘ç»œæ”¯æŒ
3. èƒ½é‡æ± åŠ¨æ€ç®¡ç†

#### ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•å’Œéƒ¨ç½²

1. åŠŸèƒ½æµ‹è¯•
2. æ€§èƒ½æµ‹è¯•
3. ç°åº¦å‘å¸ƒ

### 6.2 æ•°æ®è¿ç§»è„šæœ¬

```sql
-- è¿ç§»è„šæœ¬ï¼šä»ç¯å¢ƒå˜é‡åˆ°æ•°æ®åº“é…ç½®

-- 1. è¿ç§»TRONç½‘ç»œé…ç½®
INSERT INTO tron_networks (network_name, display_name, full_host, is_testnet, priority)
SELECT 
    CASE 
        WHEN '${TRON_NETWORK}' = 'mainnet' THEN 'mainnet'
        WHEN '${TRON_NETWORK}' = 'shasta' THEN 'shasta'
        ELSE 'nile'
    END,
    CASE 
        WHEN '${TRON_NETWORK}' = 'mainnet' THEN 'TRONä¸»ç½‘'
        WHEN '${TRON_NETWORK}' = 'shasta' THEN 'Shastaæµ‹è¯•ç½‘'
        ELSE 'Nileæµ‹è¯•ç½‘'
    END,
    '${TRON_FULL_NODE}',
    '${TRON_NETWORK}' != 'mainnet',
    100
WHERE NOT EXISTS (
    SELECT 1 FROM tron_networks WHERE network_name = '${TRON_NETWORK}'
);

-- 2. è¿ç§»Telegramæœºå™¨äººé…ç½®
INSERT INTO telegram_bots (
    bot_name, 
    bot_token, 
    webhook_config,
    is_active
)
SELECT 
    'é»˜è®¤æœºå™¨äºº',
    '${TELEGRAM_BOT_TOKEN}',
    jsonb_build_object(
        'url', '${TELEGRAM_WEBHOOK_URL}',
        'secret_token', '${TELEGRAM_WEBHOOK_SECRET}',
        'allowed_updates', array['message', 'callback_query']
    ),
    true
WHERE NOT EXISTS (
    SELECT 1 FROM telegram_bots WHERE bot_token = '${TELEGRAM_BOT_TOKEN}'
);

-- 3. è¿ç§»èƒ½é‡æ± é…ç½®
INSERT INTO energy_pools (
    account_name,
    address,
    encrypted_private_key,
    network_id,
    account_type,
    is_active
)
SELECT 
    'é»˜è®¤èƒ½é‡æ± ',
    '${TRON_ADDRESS}',
    encrypt_private_key('${TRON_PRIVATE_KEY}'), -- éœ€è¦å®ç°åŠ å¯†å‡½æ•°
    (SELECT id FROM tron_networks WHERE network_name = '${TRON_NETWORK}'),
    'own_energy',
    true
WHERE NOT EXISTS (
    SELECT 1 FROM energy_pools WHERE address = '${TRON_ADDRESS}'
);

-- 4. åˆ›å»ºæœºå™¨äººç½‘ç»œå…³è”
INSERT INTO bot_network_configs (
    bot_id,
    network_id,
    is_primary,
    energy_pool_ids
)
SELECT 
    b.id,
    n.id,
    true,
    array[p.id]
FROM telegram_bots b
CROSS JOIN tron_networks n
JOIN energy_pools p ON p.network_id = n.id
WHERE b.bot_token = '${TELEGRAM_BOT_TOKEN}'
    AND n.network_name = '${TRON_NETWORK}'
    AND NOT EXISTS (
        SELECT 1 FROM bot_network_configs 
        WHERE bot_id = b.id AND network_id = n.id
    );
```

### 6.3 é…ç½®æœåŠ¡é‡æ„

```typescript
// é…ç½®ç®¡ç†æœåŠ¡
class ConfigurationService {
    private configCache = new Map<string, any>();
    private cacheExpiry = new Map<string, number>();
    
    // è·å–æœºå™¨äººé…ç½®
    async getBotConfig(botId: string): Promise<BotConfig> {
        const cacheKey = `bot_config:${botId}`;
        
        if (this.isConfigCached(cacheKey)) {
            return this.configCache.get(cacheKey);
        }
        
        const bot = await TelegramBot.findByPk(botId, {
            include: [
                {
                    model: BotNetworkConfig,
                    include: [TronNetwork, EnergyPool]
                }
            ]
        });
        
        const config = this.transformBotConfig(bot);
        this.cacheConfig(cacheKey, config, 300); // ç¼“å­˜5åˆ†é’Ÿ
        
        return config;
    }
    
    // è·å–TRONç½‘ç»œé…ç½®
    async getTronNetworkConfig(networkId: string): Promise<TronNetworkConfig> {
        const cacheKey = `tron_network:${networkId}`;
        
        if (this.isConfigCached(cacheKey)) {
            return this.configCache.get(cacheKey);
        }
        
        const network = await TronNetwork.findByPk(networkId);
        if (!network) {
            throw new Error(`TRONç½‘ç»œé…ç½®ä¸å­˜åœ¨: ${networkId}`);
        }
        
        const config = {
            networkName: network.network_name,
            fullHost: network.full_host,
            apiKey: await this.decryptApiKey(network.api_key),
            contracts: network.contracts,
            energyPrice: network.energy_price
        };
        
        this.cacheConfig(cacheKey, config, 600); // ç¼“å­˜10åˆ†é’Ÿ
        return config;
    }
    
    // è·å–èƒ½é‡æ± é…ç½®
    async getEnergyPoolConfig(poolId: string): Promise<EnergyPoolConfig> {
        const cacheKey = `energy_pool:${poolId}`;
        
        if (this.isConfigCached(cacheKey)) {
            return this.configCache.get(cacheKey);
        }
        
        const pool = await EnergyPool.findByPk(poolId, {
            include: [TronNetwork]
        });
        
        if (!pool) {
            throw new Error(`èƒ½é‡æ± é…ç½®ä¸å­˜åœ¨: ${poolId}`);
        }
        
        const config = {
            address: pool.address,
            privateKey: await this.decryptPrivateKey(pool.encrypted_private_key),
            network: await this.getTronNetworkConfig(pool.network_id),
            accountType: pool.account_type,
            autoRefill: pool.auto_refill,
            minEnergyThreshold: pool.min_energy_threshold
        };
        
        this.cacheConfig(cacheKey, config, 300); // ç¼“å­˜5åˆ†é’Ÿ
        return config;
    }
    
    // é…ç½®å˜æ›´é€šçŸ¥
    async notifyConfigChange(type: string, id: string) {
        const cacheKeys = Array.from(this.configCache.keys())
            .filter(key => key.includes(id));
            
        // æ¸…é™¤ç›¸å…³ç¼“å­˜
        cacheKeys.forEach(key => {
            this.configCache.delete(key);
            this.cacheExpiry.delete(key);
        });
        
        // å‘é€é…ç½®å˜æ›´äº‹ä»¶
        EventBus.emit('config:changed', { type, id });
        
        // é€šçŸ¥ç›¸å…³æœåŠ¡é‡æ–°åŠ è½½é…ç½®
        if (type === 'telegram_bot') {
            await TelegramBotManager.reloadBotConfig(id);
        } else if (type === 'tron_network') {
            await TronService.reloadNetworkConfig(id);
        } else if (type === 'energy_pool') {
            await EnergyPoolManager.reloadPoolConfig(id);
        }
    }
    
    private isConfigCached(key: string): boolean {
        const expiry = this.cacheExpiry.get(key);
        if (!expiry || Date.now() > expiry) {
            this.configCache.delete(key);
            this.cacheExpiry.delete(key);
            return false;
        }
        return this.configCache.has(key);
    }
    
    private cacheConfig(key: string, config: any, ttlSeconds: number) {
        this.configCache.set(key, config);
        this.cacheExpiry.set(key, Date.now() + ttlSeconds * 1000);
    }
}
```

### 6.4 ç¯å¢ƒå˜é‡æ¸…ç†

```bash
# æ›´æ–°åçš„ .env æ–‡ä»¶ï¼ˆç§»é™¤å·²è¿ç§»çš„é…ç½®ï¼‰

# =================================================================================================
# TRON èƒ½é‡ç§Ÿèµç³»ç»Ÿ - ç¯å¢ƒé…ç½®æ–‡ä»¶ (é…ç½®è¿ç§»åç‰ˆæœ¬)
# =================================================================================================

# =================================================================================================
# ğŸš€ å‰ç«¯é…ç½® (VITE_)
# =================================================================================================
VITE_VUE_DEVTOOLS=true
VITE_ENV=development
VITE_API_URL=http://localhost:3001
VITE_PORT=5173

# =================================================================================================
# ğŸŒ ç¯å¢ƒå’ŒæœåŠ¡å™¨é…ç½®
# =================================================================================================
NODE_ENV=development
PORT=3001
HOST_ADDRESS=localhost
API_BASE_URL=http://localhost:3001

# =================================================================================================
# ğŸ—„ï¸ æ•°æ®åº“é…ç½® (PostgreSQL)
# =================================================================================================
DB_HOST=localhost
DB_PORT=5432
DB_NAME=tron_energy_rental
DB_USER=postgres
DB_PASSWORD=postgres
DB_SCHEMA=tron_energy
DB_SSL=false
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/tron_energy_rental
DB_MAX_CONNECTIONS=20
DB_IDLE_TIMEOUT=30000
DB_CONNECTION_TIMEOUT=2000

# =================================================================================================
# ğŸ”„ Redis é…ç½®
# =================================================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=tron_energy
REDIS_SESSION_TTL=86400
REDIS_CACHE_TTL=3600

# =================================================================================================
# ğŸ” JWT é…ç½®
# =================================================================================================
JWT_SECRET=tron-energy-rental-super-secret-jwt-key-2024-production-ready
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# =================================================================================================
# ğŸ”’ å®‰å…¨é…ç½®
# =================================================================================================
ENCRYPTION_KEY=your-32-character-encryption-key-here
HASH_SALT_ROUNDS=12
API_RATE_LIMIT=100
API_RATE_WINDOW=900000

# =================================================================================================
# ğŸ“ æ—¥å¿—é…ç½®
# =================================================================================================
LOG_LEVEL=info
LOG_FILE_PATH=./logs
LOG_MAX_SIZE=10m
LOG_MAX_FILES=5
LOG_DATE_PATTERN=YYYY-MM-DD

# =================================================================================================
# ğŸ“§ é‚®ä»¶é…ç½® (å¯é€‰)
# =================================================================================================
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
MAIL_FROM=noreply@tronrental.com

# =================================================================================================
# ğŸ”§ ç³»ç»Ÿé…ç½®
# =================================================================================================
TIMEZONE=Asia/Shanghai
DEFAULT_LANGUAGE=zh-CN
FILE_UPLOAD_MAX_SIZE=10485760
SESSION_SECRET=tron-energy-session-secret-key-2024

# =================================================================================================
# ğŸ“Š ç›‘æ§é…ç½®
# =================================================================================================
HEALTH_CHECK_INTERVAL=30000
METRICS_ENABLED=true
METRICS_PORT=9090

# =================================================================================================
# æ³¨æ„äº‹é¡¹
# =================================================================================================
# 1. Telegramæœºå™¨äººé…ç½®å·²è¿ç§»åˆ°ç®¡ç†åå°æ•°æ®åº“
# 2. TRONç½‘ç»œé…ç½®å·²è¿ç§»åˆ°ç®¡ç†åå°æ•°æ®åº“
# 3. èƒ½é‡æ± è´¦æˆ·é…ç½®å·²è¿ç§»åˆ°ç®¡ç†åå°æ•°æ®åº“
# 4. æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ç§é’¥ã€Tokenï¼‰ç°åœ¨åŠ å¯†å­˜å‚¨åœ¨æ•°æ®åº“ä¸­
# 5. é…ç½®å˜æ›´é€šè¿‡ç®¡ç†åå°è¿›è¡Œï¼Œæ”¯æŒå®æ—¶ç”Ÿæ•ˆ
```

## 7. å®‰å…¨è€ƒè™‘

### 7.1 æ•æ„Ÿä¿¡æ¯åŠ å¯†

```typescript
// åŠ å¯†æœåŠ¡
class EncryptionService {
    private readonly algorithm = 'aes-256-gcm';
    private readonly keyLength = 32;
    
    constructor(private encryptionKey: string) {
        if (encryptionKey.length !== this.keyLength) {
            throw new Error('åŠ å¯†å¯†é’¥é•¿åº¦å¿…é¡»ä¸º32å­—ç¬¦');
        }
    }
    
    // åŠ å¯†ç§é’¥
    encryptPrivateKey(privateKey: string): string {
        const iv = crypto.randomBytes(16);
        const cipher = crypto.createCipher(this.algorithm, this.encryptionKey);
        cipher.setAAD(Buffer.from('private_key'));
        
        let encrypted = cipher.update(privateKey, 'utf8', 'hex');
        encrypted += cipher.final('hex');
        
        const authTag = cipher.getAuthTag();
        
        return `${iv.toString('hex')}:${authTag.toString('hex')}:${encrypted}`;
    }
    
    // è§£å¯†ç§é’¥
    decryptPrivateKey(encryptedData: string): string {
        const [ivHex, authTagHex, encrypted] = encryptedData.split(':');
        
        const iv = Buffer.from(ivHex, 'hex');
        const authTag = Buffer.from(authTagHex, 'hex');
        
        const decipher = crypto.createDecipher(this.algorithm, this.encryptionKey);
        decipher.setAAD(Buffer.from('private_key'));
        decipher.setAuthTag(authTag);
        
        let decrypted = decipher.update(encrypted, 'hex', 'utf8');
        decrypted += decipher.final('utf8');
        
        return decrypted;
    }
    
    // åŠ å¯†APIå¯†é’¥
    encryptApiKey(apiKey: string): string {
        // ç±»ä¼¼ç§é’¥åŠ å¯†é€»è¾‘
        return this.encryptPrivateKey(apiKey);
    }
    
    // è§£å¯†APIå¯†é’¥
    decryptApiKey(encryptedApiKey: string): string {
        // ç±»ä¼¼ç§é’¥è§£å¯†é€»è¾‘
        return this.decryptPrivateKey(encryptedApiKey);
    }
}
```

### 7.2 æƒé™æ§åˆ¶

```typescript
// æƒé™ä¸­é—´ä»¶
class PermissionMiddleware {
    // æ£€æŸ¥é…ç½®ç®¡ç†æƒé™
    static checkConfigPermission(requiredPermission: string) {
        return async (req: Request, res: Response, next: NextFunction) => {
            try {
                const user = req.user as AdminUser;
                
                if (!user) {
                    return res.status(401).json({ error: 'æœªæˆæƒè®¿é—®' });
                }
                
                const hasPermission = await this.hasPermission(
                    user.id, 
                    requiredPermission
                );
                
                if (!hasPermission) {
                    return res.status(403).json({ 
                        error: 'æƒé™ä¸è¶³',
                        required: requiredPermission
                    });
                }
                
                next();
            } catch (error) {
                res.status(500).json({ error: 'æƒé™æ£€æŸ¥å¤±è´¥' });
            }
        };
    }
    
    private static async hasPermission(
        userId: string, 
        permission: string
    ): Promise<boolean> {
        // æ£€æŸ¥ç”¨æˆ·æƒé™é€»è¾‘
        const userPermissions = await AdminPermission.findAll({
            where: { admin_id: userId },
            include: [Permission]
        });
        
        return userPermissions.some(
            up => up.Permission.permission_name === permission
        );
    }
}

// è·¯ç”±æƒé™é…ç½®
router.get('/bots', 
    PermissionMiddleware.checkConfigPermission('bot:read'),
    BotController.list
);

router.post('/bots', 
    PermissionMiddleware.checkConfigPermission('bot:create'),
    BotController.create
);

router.put('/bots/:id', 
    PermissionMiddleware.checkConfigPermission('bot:update'),
    BotController.update
);
```

### 7.3 å®¡è®¡æ—¥å¿—

```typescript
// å®¡è®¡æ—¥å¿—æœåŠ¡
class AuditLogService {
    static async logConfigChange({
        tableName,
        recordId,
        actionType,
        oldValues,
        newValues,
        changedBy,
        ipAddress,
        userAgent,
        changeReason
    }: AuditLogData) {
        try {
            const changedFields = this.getChangedFields(oldValues, newValues);
            
            await SystemConfigHistory.create({
                table_name: tableName,
                record_id: recordId,
                action_type: actionType,
                old_values: oldValues,
                new_values: newValues,
                changed_fields: changedFields,
                change_reason: changeReason,
                changed_by: changedBy,
                ip_address: ipAddress,
                user_agent: userAgent
            });
            
            // å‘é€å®¡è®¡äº‹ä»¶
            EventBus.emit('audit:config_changed', {
                tableName,
                recordId,
                actionType,
                changedBy
            });
            
        } catch (error) {
            logger.error('å®¡è®¡æ—¥å¿—è®°å½•å¤±è´¥:', error);
        }
    }
    
    private static getChangedFields(
        oldValues: any, 
        newValues: any
    ): string[] {
        const changed: string[] = [];
        
        if (!oldValues) return Object.keys(newValues || {});
        
        for (const key in newValues) {
            if (JSON.stringify(oldValues[key]) !== JSON.stringify(newValues[key])) {
                changed.push(key);
            }
        }
        
        return changed;
    }
}
```

## 8. éƒ¨ç½²å’Œè¿ç»´

### 8.1 éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æ•°æ®åº“è¡¨ç»“æ„å·²åˆ›å»º
- [ ] ç°æœ‰é…ç½®å·²è¿ç§»åˆ°æ•°æ®åº“
- [ ] åŠ å¯†å¯†é’¥å·²é…ç½®
- [ ] æƒé™ç³»ç»Ÿå·²è®¾ç½®
- [ ] å®¡è®¡æ—¥å¿—å·²å¯ç”¨
- [ ] é…ç½®ç¼“å­˜å·²å¯ç”¨
- [ ] å¥åº·æ£€æŸ¥å·²é…ç½®
- [ ] ç›‘æ§å‘Šè­¦å·²è®¾ç½®
- [ ] å¤‡ä»½ç­–ç•¥å·²åˆ¶å®š

### 8.2 ç›‘æ§æŒ‡æ ‡

```typescript
// ç›‘æ§æŒ‡æ ‡æ”¶é›†
class ConfigMetrics {
    // é…ç½®å˜æ›´é¢‘ç‡
    static configChangeRate = new prometheus.Counter({
        name: 'config_changes_total',
        help: 'é…ç½®å˜æ›´æ€»æ•°',
        labelNames: ['table_name', 'action_type']
    });
    
    // é…ç½®åŠ è½½æ—¶é—´
    static configLoadTime = new prometheus.Histogram({
        name: 'config_load_duration_seconds',
        help: 'é…ç½®åŠ è½½è€—æ—¶',
        labelNames: ['config_type']
    });
    
    // ç¼“å­˜å‘½ä¸­ç‡
    static cacheHitRate = new prometheus.Gauge({
        name: 'config_cache_hit_rate',
        help: 'é…ç½®ç¼“å­˜å‘½ä¸­ç‡'
    });
    
    // æ´»è·ƒæœºå™¨äººæ•°é‡
    static activeBots = new prometheus.Gauge({
        name: 'active_bots_count',
        help: 'æ´»è·ƒæœºå™¨äººæ•°é‡'
    });
    
    // æ´»è·ƒèƒ½é‡æ± æ•°é‡
    static activeEnergyPools = new prometheus.Gauge({
        name: 'active_energy_pools_count',
        help: 'æ´»è·ƒèƒ½é‡æ± æ•°é‡'
    });
}
```

### 8.3 æ•…éšœæ¢å¤

```typescript
// é…ç½®æ•…éšœæ¢å¤
class ConfigRecoveryService {
    // é…ç½®å›æ»š
    static async rollbackConfig(
        tableName: string, 
        recordId: string, 
        targetVersion: string
    ) {
        const history = await SystemConfigHistory.findOne({
            where: {
                table_name: tableName,
                record_id: recordId,
                id: targetVersion
            }
        });
        
        if (!history) {
            throw new Error('ç›®æ ‡ç‰ˆæœ¬ä¸å­˜åœ¨');
        }
        
        // æ‰§è¡Œå›æ»šæ“ä½œ
        await this.applyConfigValues(
            tableName, 
            recordId, 
            history.old_values
        );
        
        // è®°å½•å›æ»šæ“ä½œ
        await AuditLogService.logConfigChange({
            tableName,
            recordId,
            actionType: 'rollback',
            oldValues: history.new_values,
            newValues: history.old_values,
            changedBy: 'system',
            changeReason: `å›æ»šåˆ°ç‰ˆæœ¬ ${targetVersion}`
        });
    }
    
    // é…ç½®å¥åº·æ£€æŸ¥
    static async healthCheck(): Promise<ConfigHealthStatus> {
        const checks = {
            database: await this.checkDatabaseConnection(),
            cache: await this.checkCacheConnection(),
            bots: await this.checkBotsHealth(),
            networks: await this.checkNetworksHealth(),
            energyPools: await this.checkEnergyPoolsHealth()
        };
        
        const isHealthy = Object.values(checks).every(check => check.status === 'healthy');
        
        return {
            overall: isHealthy ? 'healthy' : 'unhealthy',
            checks,
            timestamp: new Date().toISOString()
        };
    }
}
```

## 9. æ€»ç»“

æœ¬æŠ€æœ¯æ¶æ„æ–‡æ¡£è¯¦ç»†æè¿°äº†å°†Telegramæœºå™¨äººå’ŒTRONé…ç½®ä»ç¯å¢ƒå˜é‡è¿ç§»åˆ°ç®¡ç†åå°çš„å®Œæ•´æ–¹æ¡ˆã€‚ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š

1. **æ•°æ®åº“é©±åŠ¨é…ç½®**ï¼šæ‰€æœ‰é…ç½®å­˜å‚¨åœ¨PostgreSQLæ•°æ®åº“ä¸­ï¼Œæ”¯æŒåŠ¨æ€ä¿®æ”¹
2. **å¤šå®ä¾‹ç®¡ç†**ï¼šæ”¯æŒå¤šä¸ªTelegramæœºå™¨äººå’Œå¤šä¸ªTRONç½‘ç»œç¯å¢ƒ
3. **å®‰å…¨åŠ å¯†å­˜å‚¨**ï¼šæ•æ„Ÿä¿¡æ¯ï¼ˆç§é’¥ã€Tokenï¼‰é‡‡ç”¨AES-256-GCMåŠ å¯†
4. **å®æ—¶é…ç½®æ›´æ–°**ï¼šé…ç½®å˜æ›´åè‡ªåŠ¨é€šçŸ¥ç›¸å…³æœåŠ¡é‡æ–°åŠ è½½
5. **å®Œæ•´çš„å®¡è®¡è¿½è¸ª**ï¼šè®°å½•æ‰€æœ‰é…ç½®å˜æ›´å†å²å’Œæ“ä½œæ—¥å¿—
6. **ç”¨æˆ·å‹å¥½ç•Œé¢**ï¼šæä¾›ç›´è§‚çš„ç®¡ç†åå°ç•Œé¢
7. **é«˜å¯ç”¨æ€§è®¾è®¡**ï¼šåŒ…å«ç¼“å­˜ã€ç›‘æ§ã€æ•…éšœæ¢å¤ç­‰æœºåˆ¶

é€šè¿‡è¿™ä¸ªæ¶æ„ï¼Œç³»ç»Ÿå°†å…·å¤‡æ›´å¥½çš„å¯ç»´æŠ¤æ€§ã€å®‰å…¨æ€§å’Œæ‰©å±•æ€§ï¼Œä¸ºåç»­çš„ä¸šåŠ¡å‘å±•æä¾›åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚
```

