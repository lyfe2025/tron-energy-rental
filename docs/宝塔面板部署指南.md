# TRONèƒ½é‡ç§Ÿèµç³»ç»Ÿ - å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›ä½¿ç”¨å®å¡”é¢æ¿å¯è§†åŒ–ç•Œé¢éƒ¨ç½²TRONèƒ½é‡ç§Ÿèµç³»ç»Ÿçš„è¯¦ç»†æ­¥éª¤æŒ‡å—ã€‚å®å¡”é¢æ¿æ˜¯ä¸€æ¬¾ç®€å•å¥½ç”¨çš„LinuxæœåŠ¡å™¨ç®¡ç†é¢æ¿ï¼Œé€šè¿‡Webç•Œé¢å³å¯å®Œæˆæ‰€æœ‰éƒ¨ç½²æ“ä½œã€‚

## ğŸš€ å¿«é€Ÿå¯¼èˆª

- [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
- [å®å¡”é¢æ¿å®‰è£…](#å®å¡”é¢æ¿å®‰è£…)
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [é¡¹ç›®éƒ¨ç½²](#é¡¹ç›®éƒ¨ç½²)
- [ç½‘ç«™é…ç½®](#ç½‘ç«™é…ç½®)
- [è¿›ç¨‹ç®¡ç†](#è¿›ç¨‹ç®¡ç†)
- [æ•°æ®åº“é…ç½®](#æ•°æ®åº“é…ç½®)
- [SSLè¯ä¹¦](#sslè¯ä¹¦)
- [ç›‘æ§ç»´æŠ¤](#ç›‘æ§ç»´æŠ¤)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ğŸ”§ ç³»ç»Ÿè¦æ±‚

### æœåŠ¡å™¨é…ç½®

| é…ç½®é¡¹ | æœ€ä½è¦æ±‚ | æ¨èé…ç½® |
|--------|----------|----------|
| æ“ä½œç³»ç»Ÿ | Ubuntu 18.04+ / CentOS 7+ | Ubuntu 20.04+ |
| CPU | 2æ ¸å¿ƒ | 4æ ¸å¿ƒ |
| å†…å­˜ | 2GB | 4GB+ |
| ç£ç›˜ | 20GB | 50GB+ (SSD) |
| ç½‘ç»œ | 10Må¸¦å®½ | 100Må¸¦å®½ |

### ç«¯å£è¦æ±‚

```
8888  - å®å¡”é¢æ¿è®¿é—®ç«¯å£
3001  - APIåç«¯æœåŠ¡ç«¯å£
5173  - å‰ç«¯å¼€å‘æœåŠ¡å™¨ç«¯å£ (å¼€å‘ç¯å¢ƒ)
5432  - PostgreSQLæ•°æ®åº“ç«¯å£
6379  - Redisç¼“å­˜ç«¯å£
80    - HTTPè®¿é—®ç«¯å£
443   - HTTPSè®¿é—®ç«¯å£
22    - SSHç«¯å£
```

## ğŸ“¦ å®å¡”é¢æ¿å®‰è£…

### 1. ä¸€é”®å®‰è£…å®å¡”é¢æ¿

```bash
# Ubuntu/Debianç³»ç»Ÿ
wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh

# CentOSç³»ç»Ÿ
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh
```

### 2. è·å–é¢æ¿ä¿¡æ¯

å®‰è£…å®Œæˆåï¼Œè®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
- **é¢æ¿åœ°å€**: http://æœåŠ¡å™¨IP:8888
- **ç”¨æˆ·å**: å®‰è£…æ—¶æ˜¾ç¤ºçš„ç”¨æˆ·å
- **å¯†ç **: å®‰è£…æ—¶æ˜¾ç¤ºçš„å¯†ç 
- **å®‰å…¨å…¥å£**: éšæœºç”Ÿæˆçš„å®‰å…¨è·¯å¾„

### 3. ç™»å½•å®å¡”é¢æ¿

1. åœ¨æµè§ˆå™¨ä¸­è®¿é—®é¢æ¿åœ°å€
2. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•
3. é¦–æ¬¡ç™»å½•ä¼šè¦æ±‚ç»‘å®šå®å¡”è´¦å·ï¼ˆå¯é€‰ï¼‰

## âš™ï¸ ç¯å¢ƒé…ç½®

### 1. å®‰è£…è½¯ä»¶å¥—ä»¶

#### æ­¥éª¤1ï¼šè¿›å…¥è½¯ä»¶å•†åº—
- åœ¨å®å¡”é¢æ¿å·¦ä¾§èœå•ç‚¹å‡» **"è½¯ä»¶å•†åº—"**
- é€‰æ‹© **"è¿è¡Œç¯å¢ƒ"** æ ‡ç­¾é¡µ

#### æ­¥éª¤2ï¼šå®‰è£…å¿…éœ€è½¯ä»¶

æŒ‰ä»¥ä¸‹é¡ºåºå®‰è£…è½¯ä»¶ï¼š

1. **Nginx** - WebæœåŠ¡å™¨
   - ç‚¹å‡» "ä¸€é”®å®‰è£…"
   - ç­‰å¾…å®‰è£…å®Œæˆï¼ˆçº¦5-10åˆ†é’Ÿï¼‰

2. **PostgreSQL** - æ•°æ®åº“
   - é€‰æ‹©ç‰ˆæœ¬ï¼šPostgreSQL 14.x
   - ç‚¹å‡» "ä¸€é”®å®‰è£…"
   - è®¾ç½®rootå¯†ç å¹¶è®°å½•

3. **Redis** - ç¼“å­˜æ•°æ®åº“
   - é€‰æ‹©æœ€æ–°ç‰ˆæœ¬
   - ç‚¹å‡» "ä¸€é”®å®‰è£…"

4. **Node.jsç‰ˆæœ¬ç®¡ç†å™¨**
   - æœç´¢ "Node.jsç‰ˆæœ¬ç®¡ç†å™¨"
   - ç‚¹å‡» "å®‰è£…"

#### æ­¥éª¤3ï¼šé…ç½®Node.jsç¯å¢ƒ

1. å®‰è£…å®Œæˆåï¼Œç‚¹å‡»Node.jsç‰ˆæœ¬ç®¡ç†å™¨çš„ **"è®¾ç½®"**
2. å®‰è£…Node.js 18.xç‰ˆæœ¬ï¼š
   - åœ¨ç‰ˆæœ¬åˆ—è¡¨ä¸­æ‰¾åˆ° "18.19.0" æˆ–æ›´æ–°ç‰ˆæœ¬
   - ç‚¹å‡» **"å®‰è£…"**
   - ç­‰å¾…å®‰è£…å®Œæˆ
3. è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬ï¼š
   - ç‚¹å‡»å·²å®‰è£…ç‰ˆæœ¬æ—çš„ **"åˆ‡æ¢"**
4. å…¨å±€å®‰è£…å¿…éœ€åŒ…ï¼š
   ```bash
   npm install -g pnpm pm2 tsx
   ```

### 2. æ•°æ®åº“åˆå§‹åŒ–

#### æ­¥éª¤1ï¼šé…ç½®PostgreSQL

1. è¿›å…¥ **"æ•°æ®åº“"** â†’ **"PostgreSQL"**
2. ç‚¹å‡» **"è®¾ç½®"** é…ç½®ï¼š
   - **ç›‘å¬åœ°å€**: æ”¹ä¸º `0.0.0.0`ï¼ˆå¦‚éœ€è¿œç¨‹è¿æ¥ï¼‰
   - **ç«¯å£**: ä¿æŒé»˜è®¤ `5432`
3. é‡å¯PostgreSQLæœåŠ¡

#### æ­¥éª¤2ï¼šåˆ›å»ºé¡¹ç›®æ•°æ®åº“

1. åœ¨ **"æ•°æ®åº“"** é¡µé¢ç‚¹å‡» **"æ·»åŠ æ•°æ®åº“"**
2. å¡«å†™ä¿¡æ¯ï¼š
   - **æ•°æ®åº“å**: `tron_energy_rental`
   - **ç”¨æˆ·å**: `tron_user`
   - **å¯†ç **: è®¾ç½®å¼ºå¯†ç å¹¶è®°å½•
3. ç‚¹å‡» **"æäº¤"**

#### æ­¥éª¤3ï¼šé…ç½®Redis

1. è¿›å…¥ **"è½¯ä»¶å•†åº—"** â†’ æ‰¾åˆ°Redis â†’ ç‚¹å‡» **"è®¾ç½®"**
2. é…ç½®é€‰é¡¹ï¼š
   - **å¯†ç **: è®¾ç½®Rediså¯†ç 
   - **æœ€å¤§å†…å­˜**: è®¾ç½®ä¸º512MB
   - **æŒä¹…åŒ–**: å¼€å¯AOFå’ŒRDB
3. é‡å¯RedisæœåŠ¡

## ğŸ“ é¡¹ç›®éƒ¨ç½²

### 1. åˆ›å»ºç½‘ç«™

#### æ­¥éª¤1ï¼šæ·»åŠ ç«™ç‚¹

1. åœ¨å®å¡”é¢æ¿ç‚¹å‡» **"ç½‘ç«™"** â†’ **"æ·»åŠ ç«™ç‚¹"**
2. å¡«å†™ç«™ç‚¹ä¿¡æ¯ï¼š
   - **åŸŸå**: è¾“å…¥æ‚¨çš„åŸŸåï¼ˆå¦‚ï¼š`tron.yourdomain.com`ï¼‰
   - **å¤‡æ³¨**: `TRONèƒ½é‡ç§Ÿèµç³»ç»Ÿ`
   - **æ ¹ç›®å½•**: `/www/wwwroot/tron-energy-rental`
   - **FTP**: ä¸åˆ›å»º
   - **æ•°æ®åº“**: ä¸åˆ›å»ºï¼ˆå·²åˆ›å»ºï¼‰
   - **PHPç‰ˆæœ¬**: çº¯é™æ€
3. ç‚¹å‡» **"æäº¤"**

#### æ­¥éª¤2ï¼šé…ç½®ç›®å½•æƒé™

1. ç‚¹å‡»ç«™ç‚¹æ—çš„ **"è®¾ç½®"**
2. è¿›å…¥ **"ç½‘ç«™ç›®å½•"** æ ‡ç­¾ï¼š
   - ç¡®ä¿è¿è¡Œç›®å½•ä¸º `/www/wwwroot/tron-energy-rental`
   - å–æ¶ˆå‹¾é€‰ **"é˜²è·¨ç«™æ”»å‡»"**

### 2. ä¸Šä¼ é¡¹ç›®ä»£ç 

#### æ–¹æ³•ä¸€ï¼šGitå…‹éš†ï¼ˆæ¨èï¼‰

1. è¿›å…¥ **"æ–‡ä»¶"** ç®¡ç†å™¨
2. å¯¼èˆªåˆ° `/www/wwwroot/`
3. ç‚¹å‡» **"ç»ˆç«¯"** æ‰“å¼€å‘½ä»¤è¡Œ
4. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
   ```bash
   cd /www/wwwroot
   git clone https://github.com/your-username/tron-energy-rental.git
   cd tron-energy-rental
   chown -R www:www /www/wwwroot/tron-energy-rental
   ```

#### æ–¹æ³•äºŒï¼šæ–‡ä»¶ä¸Šä¼ 

1. åœ¨æœ¬åœ°æ‰“åŒ…é¡¹ç›®ï¼š
   ```bash
   tar -czf tron-energy-rental.tar.gz tron-energy-rental/
   ```
2. åœ¨å®å¡”é¢æ¿ **"æ–‡ä»¶"** ä¸­ç‚¹å‡» **"ä¸Šä¼ "**
3. ä¸Šä¼ å‹ç¼©åŒ…åˆ° `/www/wwwroot/`
4. å³é”®å‹ç¼©åŒ…é€‰æ‹© **"è§£å‹"**

### 3. å®‰è£…é¡¹ç›®ä¾èµ–

1. åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­è¿›å…¥é¡¹ç›®ç›®å½•
2. ç‚¹å‡» **"ç»ˆç«¯"**
3. æ‰§è¡Œå®‰è£…å‘½ä»¤ï¼š
   ```bash
   cd /www/wwwroot/tron-energy-rental
   pnpm install
   ```

### 4. é…ç½®ç¯å¢ƒå˜é‡

#### æ­¥éª¤1ï¼šå¤åˆ¶é…ç½®æ¨¡æ¿

1. åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
2. å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š
   ```bash
   cp deployment/templates/env.production.template .env
   ```

#### æ­¥éª¤2ï¼šç¼–è¾‘é…ç½®æ–‡ä»¶

ç‚¹å‡» `.env` æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼Œä¿®æ”¹ä»¥ä¸‹å…³é”®é…ç½®ï¼š

```bash
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=tron_energy_rental
DB_USER=tron_user
DB_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 

# Redisé…ç½®  
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=ä½ çš„Rediså¯†ç 

# JWTå¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET=ç”Ÿæˆä¸€ä¸ªè‡³å°‘32ä½çš„å¼ºå¯†ç 

# TRONé…ç½®
TRON_NETWORK=mainnet
TRON_API_KEY=ä½ çš„TRON_APIå¯†é’¥
TRON_PRIVATE_KEY=ä½ çš„TRONç§é’¥

# Telegramæœºå™¨äººï¼ˆå¯é€‰ï¼‰
TELEGRAM_BOT_TOKEN=ä½ çš„æœºå™¨äººToken
```

### 5. æ•°æ®åº“è¿ç§»

åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œï¼š
```bash
cd /www/wwwroot/tron-energy-rental
pnpm run migrate
```

### 6. æ„å»ºé¡¹ç›®

```bash
pnpm run build
```

## ğŸŒ ç½‘ç«™é…ç½®

### 1. é…ç½®Nginxåå‘ä»£ç†

#### æ­¥éª¤1ï¼šä¿®æ”¹ç«™ç‚¹é…ç½®

1. åœ¨ **"ç½‘ç«™"** ä¸­ç‚¹å‡»ç«™ç‚¹çš„ **"è®¾ç½®"**
2. è¿›å…¥ **"é…ç½®æ–‡ä»¶"** æ ‡ç­¾
3. æ¸…ç©ºç°æœ‰é…ç½®ï¼Œç²˜è´´ä»¥ä¸‹é…ç½®ï¼š

```nginx
# TRONèƒ½é‡ç§Ÿèµç³»ç»Ÿ Nginxé…ç½®

# APIåç«¯åå‘ä»£ç†
upstream tron_energy_api {
    server 127.0.0.1:3001;
    keepalive 32;
}

# é€Ÿç‡é™åˆ¶
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

server {
    listen 80;
    server_name tron.yourdomain.com;  # ä¿®æ”¹ä¸ºä½ çš„åŸŸå
    index index.html;
    root /www/wwwroot/tron-energy-rental/dist;
    
    # å®‰å…¨å¤´éƒ¨
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # è®¿é—®æ—¥å¿—
    access_log /www/wwwlogs/tron-energy-rental.log;
    error_log /www/wwwlogs/tron-energy-rental.error.log;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_min_length 1024;
    gzip_types text/css application/javascript text/javascript application/json;
    
    # APIè·¯ç”±ä»£ç†
    location /api/ {
        limit_req zone=api_limit burst=20 nodelay;
        
        proxy_pass http://tron_energy_api;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        proxy_connect_timeout 5s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
        
        # WebSocketæ”¯æŒ
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
    
    # å¥åº·æ£€æŸ¥
    location /health {
        proxy_pass http://tron_energy_api/api/health;
        access_log off;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location /assets/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        gzip_static on;
    }
    
    # å‰ç«¯è·¯ç”±æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
        expires 1h;
        add_header Cache-Control "public";
    }
    
    # éšè—æ•æ„Ÿæ–‡ä»¶
    location ~ /\.(env|git) {
        deny all;
    }
}
```

4. ç‚¹å‡» **"ä¿å­˜"**

#### æ­¥éª¤2ï¼šé‡è½½Nginx

åœ¨ç»ˆç«¯æ‰§è¡Œï¼š
```bash
nginx -t  # æ£€æŸ¥é…ç½®è¯­æ³•
nginx -s reload  # é‡è½½é…ç½®
```

### 2. é…ç½®é˜²ç«å¢™

1. è¿›å…¥ **"å®‰å…¨"** â†’ **"é˜²ç«å¢™"**
2. æ·»åŠ ä»¥ä¸‹ç«¯å£è§„åˆ™ï¼š
   - **3001** (APIç«¯å£) - ä»…å…è®¸å†…ç½‘è®¿é—®
   - **5432** (PostgreSQL) - ä»…å…è®¸å†…ç½‘è®¿é—®  
   - **6379** (Redis) - ä»…å…è®¸å†…ç½‘è®¿é—®

## ğŸ”„ è¿›ç¨‹ç®¡ç†

### 1. é…ç½®PM2

#### æ­¥éª¤1ï¼šå®‰è£…PM2ç®¡ç†å™¨

1. è¿›å…¥ **"è½¯ä»¶å•†åº—"**
2. æœç´¢ **"PM2ç®¡ç†å™¨"**
3. ç‚¹å‡» **"å®‰è£…"**

#### æ­¥éª¤2ï¼šæ·»åŠ é¡¹ç›®åˆ°PM2

1. å®‰è£…å®Œæˆåç‚¹å‡» **"è®¾ç½®"**
2. ç‚¹å‡» **"æ·»åŠ é¡¹ç›®"**
3. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - **é¡¹ç›®åç§°**: `tron-energy-api`
   - **å¯åŠ¨æ–‡ä»¶**: `/www/wwwroot/tron-energy-rental/api/server.ts`
   - **é¡¹ç›®è·¯å¾„**: `/www/wwwroot/tron-energy-rental`
   - **å¯åŠ¨æ–¹å¼**: `tsx`
   - **ç¯å¢ƒå˜é‡**: 
     ```
     NODE_ENV=production
     ```
4. ç‚¹å‡» **"æ·»åŠ "**

#### æ­¥éª¤3ï¼šå¯åŠ¨åº”ç”¨

1. åœ¨PM2ç®¡ç†å™¨ä¸­æ‰¾åˆ°åˆšæ·»åŠ çš„é¡¹ç›®
2. ç‚¹å‡» **"å¯åŠ¨"**
3. æŸ¥çœ‹çŠ¶æ€ç¡®ä¿æ­£å¸¸è¿è¡Œ

### 2. é…ç½®è‡ªåŠ¨å¯åŠ¨

1. åœ¨PM2è®¾ç½®ä¸­ç‚¹å‡» **"å¼€æœºè‡ªå¯"**
2. é€‰æ‹©å¼€å¯è‡ªåŠ¨å¯åŠ¨
3. ä¿å­˜é…ç½®

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### 1. å¯¼å…¥åˆå§‹æ•°æ®

å¦‚æœæœ‰æ•°æ®åº“å¤‡ä»½æ–‡ä»¶ï¼š

1. è¿›å…¥ **"æ•°æ®åº“"** â†’ **"PostgreSQL"**
2. ç‚¹å‡»æ•°æ®åº“åæ—çš„ **"ç®¡ç†"**
3. åœ¨phpPgAdminä¸­ï¼š
   - é€‰æ‹©å¯¹åº”æ•°æ®åº“
   - ç‚¹å‡» **"SQL"** æ ‡ç­¾
   - ç²˜è´´SQLæ–‡ä»¶å†…å®¹æˆ–ç‚¹å‡» **"é€‰æ‹©æ–‡ä»¶"** ä¸Šä¼ 
   - ç‚¹å‡» **"æ‰§è¡Œ"**

### 2. å®šæœŸå¤‡ä»½è®¾ç½®

1. åœ¨æ•°æ®åº“åˆ—è¡¨ä¸­ç‚¹å‡» **"å¤‡ä»½"**
2. è®¾ç½®è‡ªåŠ¨å¤‡ä»½ï¼š
   - **å¤‡ä»½ç±»å‹**: æ•°æ®å¤‡ä»½
   - **å¤‡ä»½å‘¨æœŸ**: æ¯å¤©å‡Œæ™¨2ç‚¹
   - **ä¿ç•™ä»½æ•°**: 7å¤©
3. ç‚¹å‡» **"æ·»åŠ "**

### 3. æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

1. ç‚¹å‡»PostgreSQLçš„ **"è®¾ç½®"**
2. è¿›å…¥ **"æ€§èƒ½è°ƒæ•´"** æ ‡ç­¾
3. æ ¹æ®æœåŠ¡å™¨é…ç½®è°ƒæ•´ï¼š
   - **å…±äº«ç¼“å†²åŒº**: æœåŠ¡å™¨å†…å­˜çš„25%
   - **æœ‰æ•ˆç¼“å­˜å¤§å°**: æœåŠ¡å™¨å†…å­˜çš„50%
   - **æœ€å¤§è¿æ¥æ•°**: 200

## ğŸ”’ SSLè¯ä¹¦

### 1. ç”³è¯·Let's Encryptå…è´¹è¯ä¹¦

#### æ­¥éª¤1ï¼šåŸŸåè§£æ

ç¡®ä¿åŸŸåå·²æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨IPåœ°å€

#### æ­¥éª¤2ï¼šç”³è¯·è¯ä¹¦

1. åœ¨ **"ç½‘ç«™"** ä¸­ç‚¹å‡»ç«™ç‚¹çš„ **"è®¾ç½®"**
2. è¿›å…¥ **"SSL"** æ ‡ç­¾
3. é€‰æ‹© **"Let's Encrypt"**
4. å¡«å†™ä¿¡æ¯ï¼š
   - **åŸŸå**: é€‰æ‹©è¦ç”³è¯·è¯ä¹¦çš„åŸŸå
   - **é‚®ç®±**: å¡«å†™ä½ çš„é‚®ç®±åœ°å€
5. ç‚¹å‡» **"ç”³è¯·"**
6. ç­‰å¾…ç”³è¯·å®Œæˆï¼ˆé€šå¸¸1-2åˆ†é’Ÿï¼‰

#### æ­¥éª¤3ï¼šå¼€å¯å¼ºåˆ¶HTTPS

1. è¯ä¹¦ç”³è¯·æˆåŠŸåï¼Œå‹¾é€‰ **"å¼ºåˆ¶HTTPS"**
2. ç‚¹å‡» **"ä¿å­˜"**

### 2. è¯ä¹¦è‡ªåŠ¨ç»­æœŸ

å®å¡”é¢æ¿ä¼šè‡ªåŠ¨å¤„ç†Let's Encryptè¯ä¹¦ç»­æœŸï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

## ğŸ“Š ç›‘æ§ç»´æŠ¤

### 1. ç³»ç»Ÿç›‘æ§

#### æœåŠ¡å™¨ç›‘æ§

1. åœ¨å®å¡”é¢æ¿é¦–é¡µæŸ¥çœ‹ï¼š
   - CPUä½¿ç”¨ç‡
   - å†…å­˜ä½¿ç”¨ç‡
   - ç£ç›˜ä½¿ç”¨æƒ…å†µ
   - ç½‘ç»œæµé‡

#### è¿›ç¨‹ç›‘æ§

1. è¿›å…¥ **"ç³»ç»Ÿå®‰å…¨"** â†’ **"ç³»ç»Ÿä¼˜åŒ–"**
2. æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨ï¼Œç¡®è®¤å…³é”®è¿›ç¨‹è¿è¡Œæ­£å¸¸ï¼š
   - `nginx`
   - `postgres`
   - `redis-server`
   - `node` (PM2è¿›ç¨‹)

### 2. æ—¥å¿—ç®¡ç†

#### åº”ç”¨æ—¥å¿—

1. è¿›å…¥PM2ç®¡ç†å™¨
2. ç‚¹å‡»é¡¹ç›®çš„ **"æ—¥å¿—"** æŒ‰é’®æŸ¥çœ‹åº”ç”¨æ—¥å¿—

#### Nginxæ—¥å¿—

1. è¿›å…¥ **"æ–‡ä»¶"** ç®¡ç†å™¨
2. å¯¼èˆªåˆ° `/www/wwwlogs/`
3. æŸ¥çœ‹ç›¸å…³æ—¥å¿—æ–‡ä»¶ï¼š
   - `tron-energy-rental.log` (è®¿é—®æ—¥å¿—)
   - `tron-energy-rental.error.log` (é”™è¯¯æ—¥å¿—)

#### ç³»ç»Ÿæ—¥å¿—

1. è¿›å…¥ **"å®‰å…¨"** â†’ **"ç³»ç»Ÿæ—¥å¿—"**
2. æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¥å¿—

### 3. æ€§èƒ½ä¼˜åŒ–

#### æ•°æ®åº“ä¼˜åŒ–

1. å®šæœŸæ‰§è¡Œæ•°æ®åº“æ¸…ç†ï¼š
   ```sql
   VACUUM ANALYZE;
   REINDEX DATABASE tron_energy_rental;
   ```

2. ç›‘æ§æ…¢æŸ¥è¯¢ï¼š
   - åœ¨PostgreSQLè®¾ç½®ä¸­å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
   - åˆ†æå¹¶ä¼˜åŒ–æ…¢æŸ¥è¯¢SQL

#### ç¼“å­˜ä¼˜åŒ–

1. ç›‘æ§Rediså†…å­˜ä½¿ç”¨ï¼š
   ```bash
   redis-cli info memory
   ```

2. æ¸…ç†è¿‡æœŸç¼“å­˜ï¼š
   ```bash
   redis-cli FLUSHDB
   ```

### 4. å®šæœŸä»»åŠ¡è®¾ç½®

1. è¿›å…¥ **"è®¡åˆ’ä»»åŠ¡"**
2. æ·»åŠ ä»¥ä¸‹å®šæœŸä»»åŠ¡ï¼š

**æ•°æ®åº“å¤‡ä»½**
- **ä»»åŠ¡ç±»å‹**: Shellè„šæœ¬
- **ä»»åŠ¡åç§°**: æ•°æ®åº“å¤‡ä»½
- **æ‰§è¡Œå‘¨æœŸ**: æ¯å¤© 2:00
- **è„šæœ¬å†…å®¹**:
  ```bash
  #!/bin/bash
  cd /www/backup
  pg_dump -h localhost -U tron_user tron_energy_rental > tron_db_$(date +%Y%m%d_%H%M%S).sql
  find /www/backup -name "tron_db_*.sql" -mtime +7 -delete
  ```

**æ—¥å¿—æ¸…ç†**
- **ä»»åŠ¡ç±»å‹**: Shellè„šæœ¬  
- **ä»»åŠ¡åç§°**: æ¸…ç†æ—§æ—¥å¿—
- **æ‰§è¡Œå‘¨æœŸ**: æ¯å‘¨æ—¥ 3:00
- **è„šæœ¬å†…å®¹**:
  ```bash
  #!/bin/bash
  find /www/wwwlogs -name "*.log" -mtime +30 -delete
  pm2 flush
  ```

## â— æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### é—®é¢˜1: APIæ— æ³•è®¿é—®

**ç—‡çŠ¶**: å‰ç«¯é¡µé¢æ˜¾ç¤ºAPIè¿æ¥é”™è¯¯

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥PM2è¿›ç¨‹çŠ¶æ€ï¼š
   - è¿›å…¥PM2ç®¡ç†å™¨æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. æ£€æŸ¥ç«¯å£å ç”¨ï¼š
   ```bash
   netstat -tlnp | grep 3001
   ```
3. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š
   - åœ¨PM2ç®¡ç†å™¨ä¸­æŸ¥çœ‹é”™è¯¯æ—¥å¿—
4. æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼š
   ```bash
   cd /www/wwwroot/tron-energy-rental
   node -e "console.log('Testing DB connection...')"
   ```

**è§£å†³æ–¹æ¡ˆ**:
- é‡å¯PM2è¿›ç¨‹
- æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
- ç¡®è®¤æ•°æ®åº“æœåŠ¡æ­£å¸¸

#### é—®é¢˜2: æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: åº”ç”¨å¯åŠ¨æ—¶æŠ¥æ•°æ®åº“è¿æ¥é”™è¯¯

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥PostgreSQLæœåŠ¡çŠ¶æ€
2. éªŒè¯æ•°æ®åº“è´¦æˆ·å¯†ç 
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡å¯PostgreSQL
systemctl restart postgresql

# æ£€æŸ¥é…ç½®
cat /www/server/pgsql/data/postgresql.conf | grep listen_addresses
```

#### é—®é¢˜3: Redisè¿æ¥å¼‚å¸¸

**ç—‡çŠ¶**: ç¼“å­˜åŠŸèƒ½å¼‚å¸¸ï¼ŒRedisè¿æ¥è¶…æ—¶

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
2. éªŒè¯Rediså¯†ç é…ç½®
3. æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡å¯Redis
systemctl restart redis

# æ¸…ç†å†…å­˜
redis-cli FLUSHALL
```

#### é—®é¢˜4: SSLè¯ä¹¦é—®é¢˜

**ç—‡çŠ¶**: HTTPSè®¿é—®å‡ºç°è¯ä¹¦é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. é‡æ–°ç”³è¯·è¯ä¹¦ï¼š
   - åœ¨SSLæ ‡ç­¾é¡µç‚¹å‡» **"é‡æ–°ç”³è¯·"**
2. æ£€æŸ¥åŸŸåè§£æï¼š
   - ç¡®ä¿åŸŸåæ­£ç¡®æŒ‡å‘æœåŠ¡å™¨IP
3. æ¸…ç†è¯ä¹¦ç¼“å­˜ï¼š
   ```bash
   rm -rf /etc/letsencrypt/live/your-domain.com
   ```

### 2. æ€§èƒ½é—®é¢˜æ’æŸ¥

#### é«˜CPUä½¿ç”¨ç‡

1. æŸ¥çœ‹è¿›ç¨‹CPUå ç”¨ï¼š
   ```bash
   top -p $(pgrep -d',' -f 'node|nginx|postgres')
   ```

2. åˆ†æåº”ç”¨æ€§èƒ½ï¼š
   - æŸ¥çœ‹APIå“åº”æ—¶é—´
   - æ£€æŸ¥æ•°æ®åº“æ…¢æŸ¥è¯¢
   - ä¼˜åŒ–å‰ç«¯èµ„æºåŠ è½½

#### å†…å­˜æ³„æ¼

1. ç›‘æ§å†…å­˜ä½¿ç”¨ï¼š
   ```bash
   free -h
   ps aux --sort=-%mem | head
   ```

2. PM2å†…å­˜ç›‘æ§ï¼š
   ```bash
   pm2 monit
   ```

3. è®¾ç½®å†…å­˜é™åˆ¶ï¼š
   ```bash
   pm2 start api/server.ts --max-memory-restart 500M
   ```

### 3. æ•°æ®æ¢å¤

#### ä»å¤‡ä»½æ¢å¤æ•°æ®åº“

1. åœæ­¢åº”ç”¨ï¼š
   ```bash
   pm2 stop tron-energy-api
   ```

2. æ¢å¤æ•°æ®åº“ï¼š
   ```bash
   cd /www/backup
   psql -h localhost -U tron_user -d tron_energy_rental < backup_file.sql
   ```

3. é‡å¯åº”ç”¨ï¼š
   ```bash
   pm2 restart tron-energy-api
   ```

### 4. ç´§æ€¥å¤„ç†æµç¨‹

#### ç³»ç»Ÿå´©æºƒåº”æ€¥å¤„ç†

1. **ç«‹å³å“åº”** (5åˆ†é’Ÿå†…):
   - æ£€æŸ¥æœåŠ¡å™¨åŸºç¡€çŠ¶æ€
   - é‡å¯å…³é”®æœåŠ¡
   - é€šçŸ¥ç”¨æˆ·ç»´æŠ¤ä¸­

2. **é—®é¢˜å®šä½** (15åˆ†é’Ÿå†…):
   - æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
   - åˆ†æé”™è¯¯åŸå› 
   - ç¡®å®šå½±å“èŒƒå›´

3. **å¿«é€Ÿæ¢å¤** (30åˆ†é’Ÿå†…):
   - æ‰§è¡Œæ•°æ®å›æ»š
   - ä»å¤‡ä»½æ¢å¤
   - éªŒè¯ç³»ç»ŸåŠŸèƒ½

4. **åç»­è·Ÿè¸ª**:
   - é—®é¢˜æ ¹å› åˆ†æ
   - åˆ¶å®šé¢„é˜²æªæ–½
   - æ›´æ–°ç›‘æ§ç­–ç•¥

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- **æŠ€æœ¯æ”¯æŒ**: support@yourdomain.com
- **ç´§æ€¥è”ç³»**: +86-xxx-xxxx-xxxx
- **åœ¨çº¿æ–‡æ¡£**: https://docs.yourdomain.com

### è¿œç¨‹ååŠ©
å¦‚éœ€è¿œç¨‹ååŠ©ï¼Œè¯·æä¾›ï¼š
1. å®å¡”é¢æ¿è®¿é—®åœ°å€å’Œä¸´æ—¶è´¦å·
2. æœåŠ¡å™¨SSHè®¿é—®æƒé™
3. é—®é¢˜è¯¦ç»†æè¿°å’Œé”™è¯¯æ—¥å¿—
4. é—®é¢˜å‘ç”Ÿçš„æ—¶é—´å’Œè§¦å‘æ¡ä»¶

---

## ğŸ“ é™„å½•

### A. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# PM2è¿›ç¨‹ç®¡ç†
pm2 list                 # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 restart all          # é‡å¯æ‰€æœ‰è¿›ç¨‹
pm2 logs                 # æŸ¥çœ‹æ—¥å¿—
pm2 monit               # å®æ—¶ç›‘æ§

# æ•°æ®åº“æ“ä½œ
psql -h localhost -U tron_user -d tron_energy_rental  # è¿æ¥æ•°æ®åº“
\dt                     # æŸ¥çœ‹æ‰€æœ‰è¡¨
\q                      # é€€å‡ºæ•°æ®åº“

# Redisæ“ä½œ  
redis-cli               # è¿æ¥Redis
INFO memory             # æŸ¥çœ‹å†…å­˜ä¿¡æ¯
FLUSHALL                # æ¸…ç©ºæ‰€æœ‰æ•°æ®

# Nginxæ“ä½œ
nginx -t                # æ£€æŸ¥é…ç½®è¯­æ³•
nginx -s reload         # é‡è½½é…ç½®
nginx -s restart        # é‡å¯æœåŠ¡
```

### B. ç¯å¢ƒå˜é‡å®Œæ•´é…ç½®ç¤ºä¾‹

```bash
# .env ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹
NODE_ENV=production
PORT=3001
TZ=Asia/Shanghai

# æ•°æ®åº“
DB_HOST=localhost
DB_PORT=5432
DB_NAME=tron_energy_rental
DB_USER=tron_user
DB_PASSWORD=your_strong_password_here

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_here

# JWT
JWT_SECRET=your_super_secure_jwt_secret_minimum_32_characters_long

# TRON
TRON_NETWORK=mainnet
TRON_API_KEY=your_tron_api_key_here
TRON_PRIVATE_KEY=your_tron_private_key_here

# æ—¥å¿—
LOG_LEVEL=info
LOG_FILE_PATH=/www/wwwroot/tron-energy-rental/logs/app.log
```

### C. éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·é€ä¸€æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] æœåŠ¡å™¨ç¯å¢ƒé…ç½®æ­£ç¡®
- [ ] å®å¡”é¢æ¿æ­£å¸¸è®¿é—®
- [ ] æ•°æ®åº“åˆ›å»ºå¹¶å¯è¿æ¥
- [ ] RedisæœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] é¡¹ç›®ä»£ç éƒ¨ç½²å®Œæˆ
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“è¿ç§»æˆåŠŸæ‰§è¡Œ
- [ ] é¡¹ç›®æ„å»ºæˆåŠŸ
- [ ] PM2è¿›ç¨‹æ­£å¸¸å¯åŠ¨
- [ ] Nginxé…ç½®æ­£ç¡®
- [ ] APIæ¥å£æ­£å¸¸å“åº”
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] SSLè¯ä¹¦ç”³è¯·æˆåŠŸ
- [ ] å¼ºåˆ¶HTTPSå¼€å¯
- [ ] é˜²ç«å¢™è§„åˆ™é…ç½®
- [ ] å®šæœŸå¤‡ä»½ä»»åŠ¡è®¾ç½®
- [ ] ç›‘æ§å‘Šè­¦é…ç½®
- [ ] æ—¥å¿—è½®è½¬é…ç½®

---

> ğŸ“§ **æŠ€æœ¯æ”¯æŒ**: å¦‚éœ€è¿›ä¸€æ­¥å¸®åŠ©ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ
> 
> ğŸ”„ **æ–‡æ¡£æ›´æ–°**: æœ¬æ–‡æ¡£ä¼šå®šæœŸæ›´æ–°ï¼Œè¯·å…³æ³¨æœ€æ–°ç‰ˆæœ¬
>
> â­ **ç‰ˆæœ¬**: v1.0.0 | æ›´æ–°æ—¶é—´: 2024-12-20
