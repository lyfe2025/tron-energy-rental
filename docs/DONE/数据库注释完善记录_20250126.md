# 数据库注释完善记录

## 📋 概述

本次更新完善了能量池和网络配置相关数据库表的所有注释，确保数据库结构的可读性和可维护性。

## 🗓️ 更新时间

- **执行日期**: 2025-01-26
- **迁移文件**: `migrations/20250126_update_table_comments.sql`

## 📊 涉及的表

### 1. energy_pools 表
- **表注释**: ✅ 能量池表，存储系统中可用的能量资源池信息，支持多网络配置
- **字段注释**: ✅ 所有26个字段都有完整注释
- **重要更新**: 新添加的 `network_id` 字段注释

### 2. tron_networks 表
- **表注释**: ✅ TRON网络配置表：管理多个TRON网络环境，支持主网、测试网和私有网络
- **字段注释**: ✅ 所有21个字段都有完整注释

### 3. system_config_history 表
- **表注释**: ✅ 系统配置变更历史表：记录所有配置变更，支持审计、追踪和回滚功能

## 🆕 新增字段注释

### energy_pools.network_id
```sql
COMMENT ON COLUMN energy_pools.network_id IS '关联的TRON网络ID，指向tron_networks表，用于指定该能量池使用的网络环境（支持主网、测试网等）';
```

**说明**: 这是新添加的外键字段，用于建立能量池与TRON网络配置的关联关系。

## 📋 完整字段注释列表

### energy_pools 表字段注释

| 字段名 | 数据类型 | 注释 |
|--------|---------|------|
| id | uuid | 能量池唯一标识符（UUID） |
| name | varchar | 能量池名称，用于标识和管理不同的能量资源池 |
| tron_address | varchar | 能量池TRON地址，用于区块链交互的地址 |
| private_key_encrypted | text | 加密的私钥（用于能量委托），确保安全存储 |
| total_energy | bigint | 总能量容量，该能量池可提供的最大能量值 |
| available_energy | bigint | 可用能量数量，当前可以使用的能量值 |
| reserved_energy | bigint | 预留能量数量，已被预留但未使用的能量值 |
| status | varchar | 能量池状态：active-激活可用，inactive-停用，maintenance-维护中 |
| last_updated_at | timestamptz | 最后更新时间，记录能量状态的最后同步时间 |
| created_at | timestamptz | 创建时间，记录能量池的创建时间 |
| updated_at | timestamptz | 更新时间，记录能量池信息的最后修改时间 |
| account_type | enum | 账户类型：own_energy=自有能量源，agent_energy=代理商能量源，third_party=第三方供应商 |
| priority | integer | 优先级，数字越大优先级越高，用于能量分配时的优先级排序 |
| cost_per_energy | numeric | 每单位能量的成本（TRX），用于计算能量使用的成本 |
| description | text | 账户描述信息，说明账户的用途和特点 |
| contact_info | jsonb | 联系信息（JSON格式），包含账户管理员的联系方式 |
| daily_limit | bigint | 日消耗限制，控制账户每日的最大能量消耗量 |
| monthly_limit | bigint | 月消耗限制，控制账户每月的最大能量消耗量 |
| staked_trx_energy | bigint | 质押用于获取能量的TRX数量，单位为sun |
| staked_trx_bandwidth | bigint | 质押用于获取带宽的TRX数量，单位为sun |
| delegated_energy | bigint | 已委托出去的能量数量 |
| delegated_bandwidth | bigint | 已委托出去的带宽数量 |
| pending_unfreeze_energy | bigint | 待提款的能量质押TRX数量，单位为sun |
| pending_unfreeze_bandwidth | bigint | 待提款的带宽质押TRX数量，单位为sun |
| last_stake_update | timestamptz | 最后一次质押状态更新时间 |
| **network_id** | **uuid** | **关联的TRON网络ID，指向tron_networks表，用于指定该能量池使用的网络环境（支持主网、测试网等）** |

### tron_networks 表字段注释

| 字段名 | 数据类型 | 注释 |
|--------|---------|------|
| id | uuid | 网络配置唯一标识符（UUID） |
| name | varchar | 网络名称，如 "TRON Mainnet", "Shasta Testnet", "Nile Testnet" |
| network_type | varchar | 网络类型：mainnet=主网，testnet=测试网，private=私有网络 |
| rpc_url | varchar | TRON节点RPC URL，用于与区块链网络通信 |
| api_key | varchar | API密钥（如TronGrid API Key），用于访问第三方服务 |
| chain_id | integer | 链ID标识符，用于区分不同的区块链网络 |
| block_explorer_url | varchar | 区块浏览器URL，用于查看交易和地址信息 |
| is_active | boolean | 是否启用该网络，控制网络的可用性 |
| is_default | boolean | 是否为默认网络，系统默认使用的网络配置 |
| priority | integer | 网络优先级，数值越大优先级越高，用于网络选择排序 |
| timeout_ms | integer | 请求超时时间（毫秒），控制网络请求的超时设置 |
| retry_count | integer | 重试次数，网络请求失败时的重试次数 |
| rate_limit_per_second | integer | 每秒请求限制，控制网络请求的频率 |
| config | jsonb | 网络特定配置（JSON格式），存储额外的网络配置参数 |
| health_check_url | varchar | 健康检查URL，用于检测网络的可用性 |
| last_health_check | timestamptz | 最后健康检查时间，记录上次网络健康检查的时间 |
| health_status | varchar | 健康状态：healthy=健康，unhealthy=不健康，unknown=未知，error=错误 |
| description | text | 网络描述信息，详细说明网络的用途和特点 |
| created_by | uuid | 创建者用户ID，记录创建该网络配置的用户 |
| created_at | timestamptz | 创建时间，记录网络配置的创建时间 |
| updated_at | timestamptz | 最后更新时间，记录网络配置的最后修改时间 |

## 🔗 关联关系

### 外键约束
- `energy_pools.network_id` → `tron_networks.id`
- 约束名: `energy_pools_network_id_fkey`
- 说明: 确保能量池关联的网络ID在tron_networks表中存在

## ✅ 验证结果

### 表注释验证
```sql
-- energy_pools 表注释
✅ 能量池表，存储系统中可用的能量资源池信息，支持多网络配置

-- tron_networks 表注释  
✅ TRON网络配置表：管理多个TRON网络环境，支持主网、测试网和私有网络

-- system_config_history 表注释
✅ 系统配置变更历史表：记录所有配置变更，支持审计、追踪和回滚功能
```

### 关键字段注释验证
```sql
-- network_id 字段注释
✅ 关联的TRON网络ID，指向tron_networks表，用于指定该能量池使用的网络环境（支持主网、测试网等）
```

## 🎯 意义和价值

### 1. 代码可维护性
- **清晰的字段说明**: 每个字段都有详细的用途说明
- **类型说明**: 枚举字段包含所有可能的值和含义
- **约束说明**: 外键关系和业务规则都有明确说明

### 2. 团队协作
- **新团队成员**: 快速理解数据库结构和字段含义
- **文档同步**: 数据库结构变更时注释保持同步
- **问题排查**: 通过注释快速定位字段用途

### 3. 业务理解
- **网络配置**: 清楚了解能量池如何关联到不同的TRON网络
- **状态管理**: 理解各种状态值的含义和转换规则
- **限制说明**: 明确各种限制字段的作用和计算方式

## 📁 相关文件

1. **迁移脚本**: `migrations/20250126_update_table_comments.sql`
2. **功能实现**: `api/services/energy-pool/AccountManagementService.ts`
3. **网络配置**: `api/routes/energy-pools/controllers/NetworkConfigController.ts`
4. **前端显示**: `src/pages/EnergyPool/components/EnergyPoolTable.vue`

## 🔄 后续维护

### 新字段添加时
1. 添加字段的同时必须添加注释
2. 更新相关的迁移文件
3. 确保注释与实际功能保持一致

### 注释更新原则
1. **准确性**: 注释必须反映真实的字段用途
2. **完整性**: 枚举类型要列出所有可能的值
3. **一致性**: 同类字段的注释风格保持一致
4. **及时性**: 功能变更时同步更新注释

---

**✅ 数据库注释完善工作已完成，所有相关表和字段都有完整、准确的中文注释说明。**
