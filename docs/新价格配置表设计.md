# 新价格配置表设计

## 设计目标
简化价格配置系统，将现有的多个价格相关表合并为一个统一的价格配置表，支持三种价格模式。

## 新表结构：price_configs

```sql
CREATE TABLE price_configs (
    id SERIAL PRIMARY KEY,
    mode_type VARCHAR(50) NOT NULL CHECK (mode_type IN ('energy_flash', 'transaction_package', 'vip_package')),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    config JSONB NOT NULL,
    is_active BOOLEAN DEFAULT true,
    created_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_price_configs_mode_type ON price_configs(mode_type);
CREATE INDEX idx_price_configs_is_active ON price_configs(is_active);
CREATE INDEX idx_price_configs_mode_active ON price_configs(mode_type, is_active);

-- 更新时间触发器
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_price_configs_updated_at
    BEFORE UPDATE ON price_configs
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();
```

## 三种模式的配置结构

### 1. 能量闪租模式 (energy_flash)
```json
{
  "single_price": 2.6,
  "currency": "TRX",
  "max_transactions": 5,
  "max_amount": 13,
  "expiry_hours": 1,
  "double_energy_for_no_usdt": true,
  "payment_address": "配置的收款地址"
}
```

### 2. 笔数套餐模式 (transaction_package)
```json
{
  "packages": [
    {
      "name": "基础套餐",
      "transaction_count": 100,
      "price": 250,
      "currency": "TRX"
    },
    {
      "name": "高级套餐",
      "transaction_count": 500,
      "price": 1200,
      "currency": "TRX"
    }
  ],
  "daily_fee": 1,
  "daily_fee_currency": "TRX",
  "transferable": true,
  "proxy_purchase": true
}
```

### 3. VIP套餐模式 (vip_package)
```json
{
  "packages": [
    {
      "name": "VIP月卡",
      "duration_days": 30,
      "price": 500,
      "currency": "TRX",
      "benefits": {
        "unlimited_transactions": true,
        "priority_support": true,
        "no_daily_fee": true
      }
    }
  ]
}
```

## 需要删除的表

1. `pricing_strategies` - 价格策略表
2. `pricing_modes` - 定价模式表
3. `pricing_templates` - 价格模板表
4. `pricing_history` - 价格历史表
5. `energy_packages` - 能量包表（功能合并到新表）

## 保留的表

1. `system_configs` - 系统配置表（保留，但移除价格相关配置）
2. `users` - 用户表
3. `orders` - 订单表
4. 其他业务表

## 数据迁移策略

1. 从 `energy_packages` 表迁移数据到新表的 `transaction_package` 模式
2. 从 `system_configs` 表提取价格相关配置，迁移到新表
3. 清理不需要的价格配置数据

## 前端页面简化

### 移除的页面/组件
- `/pricing` - 价格配置页面（多个子页面）
- `PricingSettings.vue` - 系统设置中的定价设置
- `AgentPricingModal.vue` - 代理商价格配置
- 价格策略、定价模式、模板管理等相关组件

### 新增的页面
- `/price-config` - 统一价格配置页面
  - 三种模式的配置界面
  - 简洁的开关控制
  - 实时预览功能

## API接口简化

### 移除的API
- `/api/pricing-strategies/*`
- `/api/pricing-modes/*`
- `/api/price-templates/*`
- `/api/pricing-history/*`
- `/api/energy-packages/*`

### 新增的API
- `GET /api/price-configs` - 获取所有价格配置
- `GET /api/price-configs/:mode` - 获取指定模式的配置
- `PUT /api/price-configs/:mode` - 更新指定模式的配置
- `POST /api/price-configs/:mode/toggle` - 开关指定模式