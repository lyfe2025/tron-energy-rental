# 项目统一管理脚本使用说明

## 概述

`project.sh` 是一个统一的项目管理脚本，提供了前后台服务的启动、停止、重启、状态查看等功能。脚本会根据 `.env` 配置文件动态获取端口信息，无需硬编码。

## 功能特性

- 🚀 **智能启动**: 自动检测依赖，一键启动前后台服务
- 🛑 **安全停止**: 智能停止指定端口的所有进程，支持强制终止
- 🔄 **服务重启**: 先停止再启动，确保服务状态一致
- 📊 **状态监控**: 实时查看服务运行状态和端口占用
- 📝 **日志管理**: 查看实时日志、历史日志，支持日志清理
- 🌐 **动态地址**: 自动获取本机IP，显示本地和网络访问地址
- ⚙️ **配置驱动**: 基于 `.env` 文件配置，支持不同环境

## 快速开始

### 1. 给脚本添加执行权限
```bash
chmod +x project.sh
```

### 2. 运行脚本
```bash
./project.sh
```

### 3. 选择操作
脚本会显示交互式菜单，输入对应序号即可执行操作。

## 菜单选项

| 序号 | 功能 | 描述 |
|------|------|------|
| 1 | 启动所有服务 | 同时启动前后台服务 |
| 2 | 停止所有服务 | 停止所有运行的服务 |
| 3 | 重启所有服务 | 重启所有服务 |
| 4 | 查看服务状态 | 显示服务状态和访问地址 |
| 5 | 查看日志 | 查看服务日志文件 |
| 6 | 清理日志 | 清理所有日志文件 |
| 7 | 帮助信息 | 显示使用说明 |
| 0 | 退出 | 退出脚本 |

## 环境配置

脚本会自动读取 `.env` 文件中的配置：

```bash
# 后端服务端口
PORT=3001

# 前端服务端口  
VITE_PORT=5173

# 运行环境
NODE_ENV=development

# 访问地址配置（可选）
HOST_ADDRESS=localhost
```

## 访问地址

启动服务后，脚本会自动显示访问地址：

### 默认配置（开发环境）
- 后端: `http://localhost:3001`
- 前端: `http://localhost:5173`
- API文档: `http://localhost:3001/api`

### 自定义配置
在 `.env` 文件中设置 `HOST_ADDRESS` 来自定义访问地址：

```bash
# 使用localhost（推荐开发环境）
HOST_ADDRESS=localhost

# 使用自定义IP或域名
HOST_ADDRESS=192.168.1.100

# 使用域名
HOST_ADDRESS=myapp.example.com
```

### 智能地址选择
- **开发环境**: 优先使用 `localhost`
- **生产环境**: 自动获取本机IP地址
- **自定义配置**: 优先使用 `HOST_ADDRESS` 设置

## 日志管理

- 后端日志: `logs/backend.log`
- 前端日志: `logs/frontend.log`
- 支持实时日志查看: `tail -f logs/backend.log`

## 使用示例

### 启动所有服务
```bash
./project.sh
# 选择 1
```

### 查看服务状态
```bash
./project.sh
# 选择 4
```

### 查看实时日志
```bash
./project.sh
# 选择 5 -> 3 (实时后端日志)
# 按 Ctrl+C 退出
```

### 停止所有服务
```bash
./project.sh
# 选择 2
```

### 重启所有服务
```bash
./project.sh
# 选择 3
```

## 注意事项

1. **端口冲突**: 脚本会自动检测端口占用，避免冲突
2. **进程管理**: 使用 `lsof` 命令检测进程，确保完全停止
3. **依赖检查**: 启动前自动检查 `node_modules` 目录
4. **日志轮转**: 支持日志文件清理和管理
5. **环境适配**: 自动适配 macOS 和 Linux 系统

## 故障排除

### 服务启动失败
1. 检查端口是否被占用: `lsof -i :3001`
2. 查看日志文件: `cat logs/backend.log`
3. 检查依赖: `pnpm install`

### 端口被占用
1. 使用脚本停止服务: 选择 4 或 5/6
2. 手动查找进程: `lsof -i :3001`
3. 强制终止: `kill -9 [PID]`

### 权限问题
```bash
chmod +x project.sh
sudo ./project.sh  # 如果需要管理员权限
```

## 扩展功能

脚本支持通过环境变量扩展功能：

```bash
# 启用HTTPS (生产环境)
NODE_ENV=production
SSL_CERT=/path/to/cert.pem

# 自定义端口
PORT=8080
VITE_PORT=3000
```

## 技术实现

- **进程检测**: 使用 `lsof` 命令检测端口占用
- **IP获取**: 支持 `ifconfig` 和 `ip` 命令
- **日志管理**: 使用 `nohup` 后台运行，输出重定向
- **状态监控**: 实时检测服务启动状态
- **错误处理**: 完善的错误处理和用户提示

## 贡献

如需添加新功能或修复问题，请：

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 发起 Pull Request

## 许可证

本项目采用 MIT 许可证。
